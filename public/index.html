<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conjunto Aralia de Castilla - App Residencial</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                        'bounce-in': 'bounceIn 0.6s ease-out',
                        'pulse-glow': 'pulseGlow 2s infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' }
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' }
                        },
                        bounceIn: {
                            '0%': { transform: 'scale(0.3)', opacity: '0' },
                            '50%': { transform: 'scale(1.05)' },
                            '70%': { transform: 'scale(0.9)' },
                            '100%': { transform: 'scale(1)', opacity: '1' }
                        },
                        pulseGlow: {
                            '0%, 100%': { boxShadow: '0 0 20px rgba(59, 130, 246, 0.3)' },
                            '50%': { boxShadow: '0 0 30px rgba(59, 130, 246, 0.6)' }
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen">
    <!-- Pantalla de Login -->
    <div id="login-screen" class="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-600 via-blue-700 to-indigo-800">
        <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md mx-4 transform transition-all duration-300">
            <div class="text-center mb-8">
                <div class="bg-gradient-to-r from-blue-600 to-indigo-600 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-home text-2xl text-white"></i>
                </div>
                <h1 class="text-2xl font-bold text-gray-800 mb-2">Conjunto Aralia de Castilla</h1>
                <p class="text-gray-600">Accede a tu portal residencial</p>
            </div>

            <!-- Tabs de Login/Registro -->
            <div class="flex bg-gray-100 rounded-lg p-1 mb-6">
                <button id="login-tab" onclick="switchTab('login')" class="flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors bg-white text-blue-600 shadow-sm">
                    Iniciar Sesión
                </button>
                <button id="register-tab" onclick="switchTab('register')" class="flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors text-gray-600 hover:text-gray-800">
                    Registrarse
                </button>
            </div>

            <!-- Formulario de Login -->
            <form id="login-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                    <div class="relative">
                        <input type="email" id="login-email" required
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent pl-11"
                               placeholder="tu-email@ejemplo.com">
                        <i class="fas fa-envelope absolute left-3 top-3.5 text-gray-400"></i>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Contraseña</label>
                    <div class="relative">
                        <input type="password" id="login-password" required
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent pl-11"
                               placeholder="Tu contraseña">
                        <i class="fas fa-lock absolute left-3 top-3.5 text-gray-400"></i>
                    </div>
                </div>

                <button type="submit"
                        class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-3 px-4 rounded-lg font-medium hover:from-blue-700 hover:to-indigo-700 transition-all duration-200 shadow-lg">
                    <i class="fas fa-sign-in-alt mr-2"></i>Iniciar Sesión
                </button>
            </form>

            <!-- Formulario de Registro -->
            <form id="register-form" class="space-y-4 hidden">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Nombre Completo</label>
                    <div class="relative">
                        <input type="text" id="register-nombre" required
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent pl-11"
                               placeholder="Tu nombre completo">
                        <i class="fas fa-user absolute left-3 top-3.5 text-gray-400"></i>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                    <div class="relative">
                        <input type="email" id="register-email" required
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent pl-11"
                               placeholder="tu-email@ejemplo.com">
                        <i class="fas fa-envelope absolute left-3 top-3.5 text-gray-400"></i>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Apartamento</label>
                    <div class="relative">
                        <input type="text" id="register-apartamento" required
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent pl-11"
                               placeholder="Ej: Torre 1 - Apto 101">
                        <i class="fas fa-building absolute left-3 top-3.5 text-gray-400"></i>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Contraseña</label>
                    <div class="relative">
                        <input type="password" id="register-password" required
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent pl-11"
                               placeholder="Tu contraseña">
                        <i class="fas fa-lock absolute left-3 top-3.5 text-gray-400"></i>
                    </div>
                </div>

                <button type="submit"
                        class="w-full bg-gradient-to-r from-green-600 to-emerald-600 text-white py-3 px-4 rounded-lg font-medium hover:from-green-700 hover:to-emerald-700 transition-all duration-200 shadow-lg">
                    <i class="fas fa-user-plus mr-2"></i>Registrarse
                </button>
            </form>

            <!-- Mensaje de error/éxito -->
            <div id="auth-message" class="mt-4 p-3 rounded-lg hidden">
                <span id="auth-message-text"></span>
            </div>

            <!-- Datos de demo -->
            <div class="mt-6 p-4 bg-gray-50 rounded-lg border">
                <p class="text-xs text-gray-600 mb-2"><strong>Usuario de prueba:</strong></p>
                <p class="text-xs text-gray-600">Email: car-cbs@hotmail.com</p>
                <p class="text-xs text-gray-600">Contraseña: password1</p>
            </div>
        </div>
    </div>

    <!-- Aplicación Principal -->
    <div id="main-app" class="hidden">
    <!-- Header mejorado -->
    <div class="bg-gradient-to-r from-blue-600 via-blue-700 to-indigo-700 text-white shadow-2xl">
        <div class="p-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="bg-white/10 p-3 rounded-xl backdrop-blur-sm">
                        <i class="fas fa-home text-2xl"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold">Conjunto Aralia de Castilla</h1>
                        <p class="text-blue-100 text-sm flex items-center">
                            <i class="fas fa-user-circle mr-2"></i>
                            Bienvenido, Carlos Andrés Santos Hernández - Torre2 - Apto 401A
                        </p>
                    </div>
                </div>
                <div class="hidden md:flex items-center space-x-4">
                    <div class="bg-white/10 px-4 py-2 rounded-lg backdrop-blur-sm">
                        <span class="text-sm" id="current-time"></span>
                    </div>
                    <button class="bg-white/10 p-2 rounded-lg hover:bg-white/20 transition-colors">
                        <i class="fas fa-bell"></i>
                    </button>
                    <button onclick="logout()" class="bg-red-500/80 hover:bg-red-600 px-3 py-2 rounded-lg transition-colors text-sm">
                        <i class="fas fa-sign-out-alt mr-1"></i>Salir
                    </button>
                </div>
            </div>
        </div>

        <!-- Navigation mejorada -->
        <div class="bg-white/10 backdrop-blur-sm">
            <div class="flex overflow-x-auto scrollbar-hide">
                <button onclick="mostrarSeccion('dashboard')" class="nav-btn active" data-section="dashboard">
                    <i class="fas fa-chart-pie mr-2"></i>Dashboard
                </button>
                <button onclick="mostrarSeccion('reservas')" class="nav-btn" data-section="reservas">
                    <i class="fas fa-calendar mr-2"></i>Reservas
                </button>
                <button onclick="mostrarSeccion('pagos')" class="nav-btn" data-section="pagos">
                    <i class="fas fa-credit-card mr-2"></i>Pagos
                </button>
                <button onclick="mostrarSeccion('chat')" class="nav-btn" data-section="chat">
                    <i class="fas fa-comments mr-2"></i>Chat
                    <span id="chat-badge" class="ml-1 bg-red-500 text-xs px-1.5 py-0.5 rounded-full hidden">3</span>
                </button>
                <button onclick="mostrarSeccion('emprendimientos')" class="nav-btn" data-section="emprendimientos">
                    <i class="fas fa-store mr-2"></i>Emprendimientos
                </button>
                <button onclick="mostrarSeccion('pqr')" class="nav-btn" data-section="pqr">
                    <i class="fas fa-file-alt mr-2"></i>PQR
                </button>
                <button onclick="mostrarSeccion('permisos')" class="nav-btn" data-section="permisos">
                    <i class="fas fa-shield-alt mr-2"></i>Permisos
                </button>
                <button onclick="mostrarSeccion('arriendos')" class="nav-btn" data-section="arriendos">
                    <i class="fas fa-home mr-2"></i>Arriendos
                </button>
                <button onclick="mostrarSeccion('parqueaderos')" class="nav-btn" data-section="parqueaderos">
                    <i class="fas fa-car mr-2"></i>Parqueaderos
                </button>
                <button onclick="mostrarSeccion('vehiculos')" class="nav-btn" data-section="vehiculos">
                    <i class="fas fa-parking mr-2"></i>Control Vehículos
                </button>
            </div>
        </div>
    </div>

    <!-- Dashboard Section -->
    <div id="dashboard-section" class="container mx-auto px-4 py-6">
        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-100 hover:shadow-xl transition-shadow">
                <div class="flex items-center">
                    <div class="p-3 bg-blue-100 rounded-lg">
                        <i class="fas fa-calendar text-blue-600 text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm text-gray-600">Reservas Activas</p>
                        <p class="text-2xl font-bold text-gray-800" id="total-reservas">2</p>
                    </div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-100 hover:shadow-xl transition-shadow">
                <div class="flex items-center">
                    <div class="p-3 bg-green-100 rounded-lg">
                        <i class="fas fa-dollar-sign text-green-600 text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm text-gray-600">Pagos Pendientes</p>
                        <p class="text-2xl font-bold text-red-600" id="pagos-pendientes">$450,000</p>
                    </div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-100 hover:shadow-xl transition-shadow">
                <div class="flex items-center">
                    <div class="p-3 bg-purple-100 rounded-lg">
                        <i class="fas fa-comments text-purple-600 text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm text-gray-600">Mensajes Nuevos</p>
                        <p class="text-2xl font-bold text-purple-600" id="mensajes-nuevos">3</p>
                    </div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-100 hover:shadow-xl transition-shadow">
                <div class="flex items-center">
                    <div class="p-3 bg-orange-100 rounded-lg">
                        <i class="fas fa-file-alt text-orange-600 text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm text-gray-600">PQR Abiertas</p>
                        <p class="text-2xl font-bold text-orange-600" id="pqr-abiertas">2</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Grid con dos columnas: Actividad Reciente y Últimas Noticias -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Actividad Reciente -->
            <div class="bg-white rounded-xl shadow-lg border border-gray-100 p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4">
                    <i class="fas fa-clock text-blue-600 mr-2"></i>Actividad Reciente
                </h3>
                <div id="recent-activity" class="space-y-4">
                    <!-- Se carga dinámicamente -->
                </div>
            </div>

            <!-- Últimas Noticias -->
            <div class="bg-white rounded-xl shadow-lg border border-gray-100 p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-bold text-gray-800">
                        <i class="fas fa-newspaper text-green-600 mr-2"></i>Últimas Noticias
                    </h3>
                    <button onclick="abrirModalNoticias()"
                            class="text-blue-600 hover:text-blue-800 text-sm font-medium flex items-center space-x-1">
                        <span>Ver todas</span>
                        <i class="fas fa-arrow-right text-xs"></i>
                    </button>
                </div>
                <div id="noticias-preview" class="space-y-4">
                    <!-- Se carga dinámicamente -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Nueva Reserva Funcional -->
    <div id="reservas-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-xl w-full max-w-5xl mx-4 max-h-[90vh] overflow-y-auto">
            <!-- Header del Modal -->
            <div class="bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6 rounded-t-xl">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-2xl font-bold">Nueva Reserva</h3>
                        <p class="text-blue-100 mt-1">Reserva tu espacio favorito</p>
                    </div>
                    <button onclick="cerrarModalReservas()" class="p-2 hover:bg-white/20 rounded-lg transition-colors">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>

                <!-- Indicadores de Progreso -->
                <div class="flex items-center justify-center mt-4 space-x-4">
                    <div class="step-indicator active flex items-center">
                        <div class="w-8 h-8 bg-white text-blue-600 rounded-full flex items-center justify-center font-bold">1</div>
                        <span class="ml-2 text-blue-100">Espacio</span>
                    </div>
                    <div class="w-12 h-0.5 bg-blue-400"></div>
                    <div class="step-indicator flex items-center">
                        <div class="w-8 h-8 bg-blue-400 text-white rounded-full flex items-center justify-center font-bold">2</div>
                        <span class="ml-2 text-blue-200">Fecha y Hora</span>
                    </div>
                </div>
            </div>

            <!-- Paso 1: Seleccionar Espacio -->
            <div id="paso-1" class="p-6">
                <h4 class="text-xl font-semibold text-gray-800 mb-6">Selecciona el espacio que deseas reservar</h4>

                <div id="espacios-grid" class="grid grid-cols-2 md:grid-cols-3 gap-6">
                    <!-- Los espacios se cargan dinámicamente -->
                </div>

                <div class="flex justify-end mt-8">
                    <button id="btn-siguiente" onclick="siguientePaso()" disabled
                            class="bg-blue-600 hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed text-white py-3 px-8 rounded-lg transition-colors font-medium">
                        Siguiente <i class="fas fa-arrow-right ml-2"></i>
                    </button>
                </div>
            </div>

            <!-- Paso 2: Seleccionar Fecha y Hora -->
            <div id="paso-2" class="p-6 hidden">
                <h4 class="text-xl font-semibold text-gray-800 mb-6">Selecciona la fecha y hora</h4>

                <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                    <!-- Mini Calendario -->
                    <div class="lg:col-span-1">
                        <h5 class="font-medium text-gray-700 mb-3">Navegación</h5>
                        <div id="mini-calendario" class="bg-gray-50 rounded-lg p-4">
                            <!-- Se carga dinámicamente -->
                        </div>
                    </div>

                    <!-- Calendario Principal -->
                    <div class="lg:col-span-3">
                        <h5 class="font-medium text-gray-700 mb-3">Horarios Disponibles</h5>

                        <!-- Controles de Vista -->
                        <div class="flex gap-2 mb-4">
                            <button onclick="cambiarVistaCalendario('semana')" class="view-btn active px-4 py-2 bg-blue-100 text-blue-600 rounded-lg font-medium hover:bg-blue-200 transition-colors">
                                Semana
                            </button>
                            <button onclick="cambiarVistaCalendario('mes')" class="view-btn px-4 py-2 bg-gray-100 text-gray-600 rounded-lg font-medium hover:bg-gray-200 transition-colors">
                                Mes
                            </button>
                        </div>

                        <!-- Vista Semanal -->
                        <div id="calendario-semana" class="calendar-view bg-white border border-gray-200 rounded-lg overflow-hidden">
                            <!-- Se carga dinámicamente -->
                        </div>

                        <!-- Vista Mensual (hidden por defecto) -->
                        <div id="calendario-mes" class="calendar-view bg-white border border-gray-200 rounded-lg overflow-hidden hidden">
                            <!-- Se carga dinámicamente -->
                        </div>
                    </div>
                </div>

                <!-- Resumen de Reserva -->
                <div id="resumen-reserva" class="mt-6 hidden">
                    <!-- Se carga dinámicamente -->
                </div>

                <div class="flex justify-between mt-8">
                    <button onclick="pasoAnterior()" class="bg-gray-500 hover:bg-gray-600 text-white py-3 px-8 rounded-lg transition-colors font-medium">
                        <i class="fas fa-arrow-left mr-2"></i> Anterior
                    </button>
                    <button id="btn-confirmar-reserva" onclick="confirmarReserva()" disabled
                            class="bg-green-600 hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed text-white py-3 px-8 rounded-lg transition-colors font-medium">
                        <i class="fas fa-check mr-2"></i> Confirmar Reserva
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Reservas Section -->
    <div id="reservas-section" class="container mx-auto px-4 py-6 hidden">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-3xl font-bold text-gray-800">
                <i class="fas fa-calendar text-blue-600 mr-3"></i>Calendario de Reservas
            </h2>
            <div class="flex gap-3">
                <button onclick="abrirModalReservas()" class="px-6 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors shadow-lg">
                    <i class="fas fa-plus mr-2"></i>Nueva Reserva
                </button>
                <button onclick="cambiarVistaCalendario('semana')" id="vista-semana" class="px-4 py-2 bg-blue-100 text-blue-600 rounded-lg font-medium hover:bg-blue-200 transition-colors">
                    Semana
                </button>
                <button onclick="cambiarVistaCalendario('mes')" id="vista-mes" class="px-4 py-2 bg-gray-100 text-gray-600 rounded-lg font-medium hover:bg-gray-200 transition-colors">
                    Mes
                </button>
            </div>
        </div>

        <!-- Calendario Principal -->
        <div class="bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden">
            <!-- Header del Calendario -->
            <div class="bg-gradient-to-r from-blue-600 to-blue-700 text-white p-4">
                <div class="flex items-center justify-between">
                    <button onclick="navegarCalendario(-1)" class="p-2 hover:bg-white/20 rounded-lg transition-colors">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <h3 id="mes-actual" class="text-xl font-bold">Septiembre 2025</h3>
                    <button onclick="navegarCalendario(1)" class="p-2 hover:bg-white/20 rounded-lg transition-colors">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>

            <!-- Vista de Semana -->
            <div id="calendario-semana" class="calendar-view">
                <!-- Header de días -->
                <div class="grid grid-cols-8 border-b border-gray-200">
                    <div class="p-3 text-center font-medium text-gray-600 border-r border-gray-200">Hora</div>
                    <div class="p-3 text-center font-medium text-gray-800 border-r border-gray-200">Lun</div>
                    <div class="p-3 text-center font-medium text-gray-800 border-r border-gray-200">Mar</div>
                    <div class="p-3 text-center font-medium text-gray-800 border-r border-gray-200">Mié</div>
                    <div class="p-3 text-center font-medium text-gray-800 border-r border-gray-200">Jue</div>
                    <div class="p-3 text-center font-medium text-gray-800 border-r border-gray-200">Vie</div>
                    <div class="p-3 text-center font-medium text-gray-800 border-r border-gray-200">Sáb</div>
                    <div class="p-3 text-center font-medium text-gray-800">Dom</div>
                </div>

                <!-- Grid de horas -->
                <div id="calendario-grid" class="max-h-96 overflow-y-auto">
                    <!-- Se genera dinámicamente -->
                </div>
            </div>

            <!-- Vista de Mes -->
            <div id="calendario-mes" class="calendar-view hidden">
                <div class="grid grid-cols-7 border-b border-gray-200">
                    <div class="p-3 text-center font-medium text-gray-800">Lun</div>
                    <div class="p-3 text-center font-medium text-gray-800">Mar</div>
                    <div class="p-3 text-center font-medium text-gray-800">Mié</div>
                    <div class="p-3 text-center font-medium text-gray-800">Jue</div>
                    <div class="p-3 text-center font-medium text-gray-800">Vie</div>
                    <div class="p-3 text-center font-medium text-gray-800">Sáb</div>
                    <div class="p-3 text-center font-medium text-gray-800">Dom</div>
                </div>
                <div id="calendario-mes-grid" class="grid grid-cols-7">
                    <!-- Se genera dinámicamente -->
                </div>
            </div>
        </div>

        <!-- Panel de Espacios -->
        <div class="mt-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
            <div class="space-selector bg-white rounded-xl shadow-lg border border-gray-100 p-4 cursor-pointer hover:shadow-xl transition-shadow"
                 data-space="salon" onclick="seleccionarEspacio('salon')">
                <div class="flex items-center justify-center mb-3">
                    <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                        <i class="fas fa-users text-blue-600 text-xl"></i>
                    </div>
                </div>
                <h4 class="text-center font-medium text-gray-800">Salón Comunal</h4>
                <p class="text-center text-sm text-gray-600 mt-1">Hasta 50 personas</p>
            </div>

            <div class="space-selector bg-white rounded-xl shadow-lg border border-gray-100 p-4 cursor-pointer hover:shadow-xl transition-shadow"
                 data-space="gimnasio" onclick="seleccionarEspacio('gimnasio')">
                <div class="flex items-center justify-center mb-3">
                    <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                        <i class="fas fa-dumbbell text-green-600 text-xl"></i>
                    </div>
                </div>
                <h4 class="text-center font-medium text-gray-800">Gimnasio</h4>
                <p class="text-center text-sm text-gray-600 mt-1">Equipos completos</p>
            </div>

            <div class="space-selector bg-white rounded-xl shadow-lg border border-gray-100 p-4 cursor-pointer hover:shadow-xl transition-shadow"
                 data-space="piscina" onclick="seleccionarEspacio('piscina')">
                <div class="flex items-center justify-center mb-3">
                    <div class="w-12 h-12 bg-cyan-100 rounded-lg flex items-center justify-center">
                        <i class="fas fa-swimmer text-cyan-600 text-xl"></i>
                    </div>
                </div>
                <h4 class="text-center font-medium text-gray-800">Piscina</h4>
                <p class="text-center text-sm text-gray-600 mt-1">Área acuática</p>
            </div>

            <div class="space-selector bg-white rounded-xl shadow-lg border border-gray-100 p-4 cursor-pointer hover:shadow-xl transition-shadow"
                 data-space="bbq" onclick="seleccionarEspacio('bbq')">
                <div class="flex items-center justify-center mb-3">
                    <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center">
                        <i class="fas fa-fire text-orange-600 text-xl"></i>
                    </div>
                </div>
                <h4 class="text-center font-medium text-gray-800">Zona BBQ</h4>
                <p class="text-center text-sm text-gray-600 mt-1">Parrillas y mesas</p>
            </div>

            <div class="space-selector bg-white rounded-xl shadow-lg border border-gray-100 p-4 cursor-pointer hover:shadow-xl transition-shadow"
                 data-space="cancha" onclick="seleccionarEspacio('cancha')">
                <div class="flex items-center justify-center mb-3">
                    <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                        <i class="fas fa-futbol text-purple-600 text-xl"></i>
                    </div>
                </div>
                <h4 class="text-center font-medium text-gray-800">Cancha Múltiple</h4>
                <p class="text-center text-sm text-gray-600 mt-1">Fútbol, básquet</p>
            </div>
        </div>

        <!-- Mis Reservas -->
        <div class="mt-6 bg-white rounded-xl shadow-lg border border-gray-100 p-6">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">Mis Reservas</h3>
            <div id="lista-reservas" class="space-y-4">
                <!-- Se cargan dinámicamente -->
            </div>
        </div>
    </div>

    <!-- Modal Nueva Reserva Estilo Outlook -->
    <div id="modal-reserva" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-xl w-full max-w-6xl mx-4 max-h-[90vh] overflow-y-auto">
            <!-- Header del Modal -->
            <div class="bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6 rounded-t-xl">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-2xl font-bold">Nueva Reserva</h3>
                        <p class="text-blue-100 mt-1">Selecciona el espacio, fecha y hora para tu reserva</p>
                    </div>
                    <button onclick="cerrarModalReservas()" class="p-2 hover:bg-white/20 rounded-lg transition-colors">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>

                <!-- Indicadores de Progreso -->
                <div class="flex items-center justify-center mt-4 space-x-4">
                    <div class="step-indicator active flex items-center">
                        <div class="w-8 h-8 bg-white text-blue-600 rounded-full flex items-center justify-center font-bold">1</div>
                        <span class="ml-2 text-blue-100">Espacio</span>
                    </div>
                    <div class="w-12 h-0.5 bg-blue-400"></div>
                    <div class="step-indicator flex items-center">
                        <div class="w-8 h-8 bg-blue-400 text-white rounded-full flex items-center justify-center font-bold">2</div>
                        <span class="ml-2 text-blue-200">Fecha y Hora</span>
                    </div>
                </div>
            </div>

            <div class="p-6">
                <!-- Paso 1: Seleccionar Espacio -->
                <div class="mb-8">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4">1. Seleccionar Espacio</h4>
                    <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4">
                        <div class="space-option cursor-pointer p-4 border-2 border-gray-200 rounded-xl hover:border-blue-500 hover:bg-blue-50 transition-all"
                             data-space="Salón Social" onclick="seleccionarEspacioModal('Salón Social', 'salon')">
                            <div class="text-center">
                                <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mx-auto mb-2">
                                    <i class="fas fa-users text-blue-600 text-xl"></i>
                                </div>
                                <h5 class="font-medium text-gray-800">Salón Social</h5>
                                <p class="text-sm text-gray-600">Hasta 50 personas</p>
                            </div>
                        </div>

                        <div class="space-option cursor-pointer p-4 border-2 border-gray-200 rounded-xl hover:border-blue-500 hover:bg-blue-50 transition-all"
                             data-space="Gimnasio" onclick="seleccionarEspacioModal('Gimnasio', 'gimnasio')">
                            <div class="text-center">
                                <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mx-auto mb-2">
                                    <i class="fas fa-dumbbell text-green-600 text-xl"></i>
                                </div>
                                <h5 class="font-medium text-gray-800">Gimnasio</h5>
                                <p class="text-sm text-gray-600">Equipos completos</p>
                            </div>
                        </div>

                        <div class="space-option cursor-pointer p-4 border-2 border-gray-200 rounded-xl hover:border-blue-500 hover:bg-blue-50 transition-all"
                             data-space="Piscina" onclick="seleccionarEspacioModal('Piscina', 'piscina')">
                            <div class="text-center">
                                <div class="w-12 h-12 bg-cyan-100 rounded-lg flex items-center justify-center mx-auto mb-2">
                                    <i class="fas fa-swimmer text-cyan-600 text-xl"></i>
                                </div>
                                <h5 class="font-medium text-gray-800">Piscina</h5>
                                <p class="text-sm text-gray-600">Área acuática</p>
                            </div>
                        </div>

                        <div class="space-option cursor-pointer p-4 border-2 border-gray-200 rounded-xl hover:border-blue-500 hover:bg-blue-50 transition-all"
                             data-space="Zona BBQ" onclick="seleccionarEspacioModal('Zona BBQ', 'bbq')">
                            <div class="text-center">
                                <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center mx-auto mb-2">
                                    <i class="fas fa-fire text-orange-600 text-xl"></i>
                                </div>
                                <h5 class="font-medium text-gray-800">Zona BBQ</h5>
                                <p class="text-sm text-gray-600">Parrillas y mesas</p>
                            </div>
                        </div>

                        <div class="space-option cursor-pointer p-4 border-2 border-gray-200 rounded-xl hover:border-blue-500 hover:bg-blue-50 transition-all"
                             data-space="Cancha Múltiple" onclick="seleccionarEspacioModal('Cancha Múltiple', 'cancha')">
                            <div class="text-center">
                                <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center mx-auto mb-2">
                                    <i class="fas fa-futbol text-purple-600 text-xl"></i>
                                </div>
                                <h5 class="font-medium text-gray-800">Cancha Múltiple</h5>
                                <p class="text-sm text-gray-600">Fútbol, básquet</p>
                            </div>
                        </div>
                    </div>

                    <div id="espacio-seleccionado" class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg hidden">
                        <div class="flex items-center">
                            <i class="fas fa-check-circle text-blue-600 mr-2"></i>
                            <span class="text-blue-800 font-medium">Espacio seleccionado: </span>
                            <span id="nombre-espacio-seleccionado" class="text-blue-800 font-bold ml-1"></span>
                        </div>
                    </div>
                </div>

                <!-- Paso 2: Seleccionar Fecha y Hora -->
                <div class="mb-8">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4">2. Seleccionar Fecha y Hora</h4>

                    <!-- Calendario Mini -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Calendario -->
                        <div>
                            <h5 class="font-medium text-gray-700 mb-3">Seleccionar Fecha</h5>
                            <div class="bg-gray-50 rounded-lg p-4">
                                <div class="flex items-center justify-between mb-4">
                                    <button onclick="cambiarMesModal(-1)" class="p-2 hover:bg-gray-200 rounded-lg">
                                        <i class="fas fa-chevron-left text-gray-600"></i>
                                    </button>
                                    <h6 id="mes-modal" class="font-semibold text-gray-800">Septiembre 2025</h6>
                                    <button onclick="cambiarMesModal(1)" class="p-2 hover:bg-gray-200 rounded-lg">
                                        <i class="fas fa-chevron-right text-gray-600"></i>
                                    </button>
                                </div>

                                <div class="grid grid-cols-7 gap-1 mb-2">
                                    <div class="text-center text-xs font-medium text-gray-600 p-2">Dom</div>
                                    <div class="text-center text-xs font-medium text-gray-600 p-2">Lun</div>
                                    <div class="text-center text-xs font-medium text-gray-600 p-2">Mar</div>
                                    <div class="text-center text-xs font-medium text-gray-600 p-2">Mié</div>
                                    <div class="text-center text-xs font-medium text-gray-600 p-2">Jue</div>
                                    <div class="text-center text-xs font-medium text-gray-600 p-2">Vie</div>
                                    <div class="text-center text-xs font-medium text-gray-600 p-2">Sáb</div>
                                </div>

                                <div id="calendario-modal-grid" class="grid grid-cols-7 gap-1">
                                    <!-- Se genera dinámicamente -->
                                </div>
                            </div>
                        </div>

                        <!-- Horarios Disponibles -->
                        <div>
                            <h5 class="font-medium text-gray-700 mb-3">Horarios Disponibles</h5>
                            <div id="horarios-disponibles" class="bg-gray-50 rounded-lg p-4 max-h-64 overflow-y-auto">
                                <p class="text-gray-500 text-center py-8">Selecciona una fecha para ver los horarios disponibles</p>
                            </div>
                        </div>
                    </div>

                    <!-- Resumen de Selección -->
                    <div id="resumen-seleccion" class="mt-6 p-4 bg-green-50 border border-green-200 rounded-lg hidden">
                        <div class="flex items-start">
                            <i class="fas fa-calendar-check text-green-600 mr-3 mt-1"></i>
                            <div>
                                <h6 class="font-medium text-green-800">Resumen de tu Reserva</h6>
                                <p class="text-green-700 mt-1">
                                    <span id="resumen-espacio"></span> -
                                    <span id="resumen-fecha"></span> a las
                                    <span id="resumen-hora"></span>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Botones de Acción -->
                <div class="flex space-x-4 pt-4 border-t border-gray-200">
                    <button type="button" onclick="cerrarModalReserva()"
                            class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 px-6 rounded-lg transition-colors font-medium">
                        <i class="fas fa-times mr-2"></i>Cancelar
                    </button>
                    <button id="btn-confirmar-reserva" onclick="confirmarReserva()" disabled
                            class="flex-1 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed text-white py-3 px-6 rounded-lg transition-colors font-medium">
                        <i class="fas fa-check mr-2"></i>Confirmar Reserva
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Sección de Pagos con diseño mejorado -->
    <div id="pagos-section" class="container mx-auto px-4 py-6 hidden">
        <h2 class="text-3xl font-bold text-gray-800 mb-6">
            <i class="fas fa-credit-card text-green-600 mr-3"></i>Estado de Pagos
        </h2>

        <!-- Resumen de Pagos -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="bg-gradient-to-r from-green-500 to-green-600 text-white p-6 rounded-xl shadow-lg">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-green-100">Pagos al Día</p>
                        <p class="text-3xl font-bold">$530,000</p>
                    </div>
                    <i class="fas fa-check-circle text-4xl text-green-200"></i>
                </div>
            </div>

            <div class="bg-gradient-to-r from-red-500 to-red-600 text-white p-6 rounded-xl shadow-lg">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-red-100">Pendientes</p>
                        <p class="text-3xl font-bold">$450,000</p>
                    </div>
                    <i class="fas fa-exclamation-triangle text-4xl text-red-200"></i>
                </div>
            </div>

            <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-6 rounded-xl shadow-lg">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-blue-100">Total Mes</p>
                        <p class="text-3xl font-bold">$980,000</p>
                    </div>
                    <i class="fas fa-calculator text-4xl text-blue-200"></i>
                </div>
            </div>
        </div>

        <!-- Lista de Pagos -->
        <div class="bg-white rounded-xl shadow-lg border border-gray-100 p-6">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">Detalle de Pagos</h3>
            <div id="lista-pagos" class="space-y-4">
                <!-- Se cargan dinámicamente -->
            </div>
        </div>
    </div>

    <!-- Arriendos Section -->
    <div id="arriendos-section" class="container mx-auto px-4 py-6 hidden">
        <div class="bg-white rounded-xl shadow-lg border border-gray-100 p-8">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-gray-800 flex items-center">
                    <i class="fas fa-home text-green-600 mr-3"></i>Gestión de Arriendos
                </h2>
                <button onclick="abrirModalNuevoArriendo()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg">
                    <i class="fas fa-plus mr-2"></i>Registrar Arriendo
                </button>
            </div>

            <!-- Tabs -->
            <div class="mb-6">
                <div class="border-b border-gray-200">
                    <nav class="-mb-px flex space-x-8">
                        <button onclick="cambiarTabArriendo('apartamentos')"
                                id="tab-apartamentos"
                                class="tab-arriendo border-b-2 border-green-500 py-2 px-1 text-sm font-medium text-green-600">
                            <i class="fas fa-home mr-2"></i>Apartamentos
                        </button>
                        <button onclick="cambiarTabArriendo('parqueaderos')"
                                id="tab-parqueaderos-arriendo"
                                class="tab-arriendo border-b-2 border-transparent py-2 px-1 text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300">
                            <i class="fas fa-car mr-2"></i>Parqueaderos
                        </button>
                    </nav>
                </div>
            </div>

            <!-- Tab Content - Apartamentos -->
            <div id="arriendos-apartamentos" class="tab-content-arriendo">
                <!-- Filtros -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <select id="filtro-torre-arriendo" class="p-3 border border-gray-300 rounded-lg">
                        <option value="">Todas las Torres</option>
                        <option value="1">Torre 1</option>
                        <option value="2">Torre 2</option>
                        <option value="3">Torre 3</option>
                    </select>
                    <select id="filtro-estado-arriendo" class="p-3 border border-gray-300 rounded-lg">
                        <option value="">Todos los Estados</option>
                        <option value="true">Disponible</option>
                        <option value="false">Arrendado</option>
                    </select>
                    <input type="number" id="filtro-precio-max" placeholder="Precio máximo" class="p-3 border border-gray-300 rounded-lg">
                    <button onclick="filtrarArriendos()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                        <i class="fas fa-search mr-2"></i>Filtrar
                    </button>
                </div>

                <!-- Lista de Apartamentos en Arriendo -->
                <div id="lista-apartamentos-arriendo" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Los apartamentos se cargan dinámicamente -->
                </div>
            </div>

            <!-- Tab Content - Parqueaderos -->
            <div id="arriendos-parqueaderos" class="tab-content-arriendo hidden">
                <!-- Filtros -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <select id="filtro-nivel-parq-arriendo" class="p-3 border border-gray-300 rounded-lg">
                        <option value="">Todos los Niveles</option>
                        <option value="Sótano 1">Sótano 1</option>
                        <option value="Sótano 2">Sótano 2</option>
                        <option value="Sótano 3">Sótano 3</option>
                    </select>
                    <select id="filtro-estado-parq-arriendo" class="p-3 border border-gray-300 rounded-lg">
                        <option value="">Todos los Estados</option>
                        <option value="true">Disponible</option>
                        <option value="false">Arrendado</option>
                    </select>
                    <button onclick="filtrarParqueaderosArriendo()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                        <i class="fas fa-search mr-2"></i>Filtrar
                    </button>
                </div>

                <!-- Lista de Parqueaderos en Arriendo -->
                <div id="lista-parqueaderos-arriendo" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <!-- Los parqueaderos se cargan dinámicamente -->
                </div>
            </div>
        </div>
    </div>

    <!-- Parqueaderos Section -->
    <div id="parqueaderos-section" class="container mx-auto px-4 py-6 hidden">
        <div class="bg-white rounded-xl shadow-lg border border-gray-100 p-8">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-gray-800 flex items-center">
                    <i class="fas fa-car text-blue-600 mr-3"></i>Gestión de Parqueaderos
                </h2>
                <div class="flex space-x-2">
                    <button onclick="abrirModalSorteoParqueaderos()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg">
                        <i class="fas fa-dice mr-2"></i>Sorteo de Parqueaderos
                    </button>
                    <button onclick="cargarParqueaderos()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                        <i class="fas fa-sync mr-2"></i>Actualizar
                    </button>
                </div>
            </div>

            <!-- Estados de Parqueaderos -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                    <div class="flex items-center">
                        <div class="p-3 bg-green-100 rounded-lg">
                            <i class="fas fa-check-circle text-green-600 text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm text-green-600">Disponibles</p>
                            <p class="text-2xl font-bold text-green-800" id="parqueaderos-disponibles">0</p>
                        </div>
                    </div>
                </div>
                <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                    <div class="flex items-center">
                        <div class="p-3 bg-red-100 rounded-lg">
                            <i class="fas fa-times-circle text-red-600 text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm text-red-600">Ocupados</p>
                            <p class="text-2xl font-bold text-red-800" id="parqueaderos-ocupados">0</p>
                        </div>
                    </div>
                </div>
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <div class="flex items-center">
                        <div class="p-3 bg-blue-100 rounded-lg">
                            <i class="fas fa-car text-blue-600 text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm text-blue-600">Total</p>
                            <p class="text-2xl font-bold text-blue-800" id="parqueaderos-total">0</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Lista de Parqueaderos -->
            <div id="lista-parqueaderos" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <!-- Los parqueaderos se cargan dinámicamente -->
            </div>
        </div>
    </div>

    <!-- Control de Vehículos Section -->
    <div id="vehiculos-section" class="container mx-auto px-4 py-6 hidden">
        <div class="bg-white rounded-xl shadow-lg border border-gray-100 p-8">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-gray-800 flex items-center">
                    <i class="fas fa-parking text-purple-600 mr-3"></i>Control de Vehículos
                </h2>
                <button onclick="abrirModalIngreso()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg">
                    <i class="fas fa-plus mr-2"></i>Registrar Ingreso
                </button>
            </div>

            <!-- Tarifas -->
            <div class="bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200 rounded-lg p-4 mb-6">
                <h3 class="font-bold text-gray-800 mb-2">🏷️ Tarifas de Parqueadero</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                    <div class="flex items-center">
                        <i class="fas fa-clock text-green-600 mr-2"></i>
                        <span>Primeras 2 horas: <strong>GRATIS</strong></span>
                    </div>
                    <div class="flex items-center">
                        <i class="fas fa-money-bill text-blue-600 mr-2"></i>
                        <span>Hora adicional: <strong>$1,000</strong></span>
                    </div>
                    <div class="flex items-center">
                        <i class="fas fa-calendar-day text-purple-600 mr-2"></i>
                        <span>Más de 15 horas: <strong>$12,000</strong></span>
                    </div>
                </div>
            </div>

            <!-- Tabs -->
            <div class="flex space-x-1 mb-6">
                <button onclick="cambiarTabVehiculos('activos')" id="tab-activos"
                        class="tab-vehiculos active px-4 py-2 rounded-lg bg-blue-600 text-white">
                    Vehículos Activos
                </button>
                <button onclick="cambiarTabVehiculos('historial')" id="tab-historial"
                        class="tab-vehiculos px-4 py-2 rounded-lg bg-gray-200 text-gray-700">
                    Historial
                </button>
                <button onclick="cambiarTabVehiculos('recibos')" id="tab-recibos"
                        class="tab-vehiculos px-4 py-2 rounded-lg bg-gray-200 text-gray-700">
                    Recibos
                </button>
            </div>

            <!-- Contenido de Tabs -->
            <div id="contenido-vehiculos-activos" class="tab-content">
                <div id="lista-vehiculos-activos" class="space-y-4">
                    <!-- Vehículos activos se cargan dinámicamente -->
                </div>
            </div>

            <div id="contenido-vehiculos-historial" class="tab-content hidden">
                <div id="lista-vehiculos-historial" class="space-y-4">
                    <!-- Historial se carga dinámicamente -->
                </div>
            </div>

            <div id="contenido-vehiculos-recibos" class="tab-content hidden">
                <div id="lista-recibos" class="space-y-4">
                    <!-- Recibos se cargan dinámicamente -->
                </div>
            </div>
        </div>
    </div>

    <!-- Chat Section con diseño WhatsApp -->
    <div id="chat-section" class="container mx-auto px-4 py-6 hidden">
        <div class="bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden" style="height: 80vh;">
            <!-- Chat Header -->
            <div class="bg-gradient-to-r from-green-600 to-green-700 text-white p-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-green-800 rounded-full flex items-center justify-center">
                            <i class="fas fa-comments"></i>
                        </div>
                        <div>
                            <h3 class="font-semibold">Chat General</h3>
                            <p class="text-green-100 text-sm">Comunidad en línea</p>
                        </div>
                    </div>
                    <div class="flex space-x-2">
                        <button onclick="seleccionarTipoChat('general')"
                                class="chat-type-btn active bg-green-800 px-3 py-1 rounded text-sm">
                            General
                        </button>
                        <button onclick="seleccionarTipoChat('administracion')"
                                class="chat-type-btn bg-green-700 hover:bg-green-800 px-3 py-1 rounded text-sm">
                            Admin
                        </button>
                        <button onclick="abrirChatPrivado()"
                                class="bg-blue-600 hover:bg-blue-700 px-3 py-1 rounded text-sm flex items-center space-x-1 relative">
                            <i class="fas fa-user-friends text-xs"></i>
                            <span>Chat Privado</span>
                            <span id="chat-privado-badge" class="hidden absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold">0</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Chat Messages -->
            <div id="chat-messages" class="flex-1 p-4 overflow-y-auto bg-gray-50" style="height: calc(80vh - 140px);">
                <!-- Mensajes se cargan dinámicamente -->
            </div>

            <!-- Chat Input -->
            <div class="border-t bg-white p-4">
                <form id="form-mensaje" class="flex space-x-3">
                    <input type="text" id="nuevo-mensaje" placeholder="Escribe tu mensaje..."
                           class="flex-1 p-3 border border-gray-300 rounded-full focus:ring-2 focus:ring-green-500 focus:border-transparent">
                    <button type="submit" class="bg-green-600 hover:bg-green-700 text-white p-3 rounded-full transition-colors">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Emprendimientos Section -->
    <div id="emprendimientos-section" class="container mx-auto px-4 py-6 hidden">
        <h2 class="text-3xl font-bold text-gray-800 mb-6">
            <i class="fas fa-store text-purple-600 mr-3"></i>Emprendimientos Residenciales
        </h2>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="lista-emprendimientos">
            <!-- Se cargan dinámicamente -->
        </div>
    </div>

    <!-- PQR Section -->
    <div id="pqr-section" class="container mx-auto px-4 py-6 hidden">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-3xl font-bold text-gray-800">
                <i class="fas fa-file-alt text-orange-600 mr-3"></i>Peticiones, Quejas y Reclamos
            </h2>
            <button onclick="document.getElementById('modal-pqr').classList.remove('hidden')"
                    class="bg-orange-600 hover:bg-orange-700 text-white px-6 py-3 rounded-lg shadow-lg transition-colors">
                <i class="fas fa-plus mr-2"></i>Nueva PQR
            </button>
        </div>

        <div class="bg-white rounded-xl shadow-lg border border-gray-100 p-6">
            <div id="lista-pqr" class="space-y-4">
                <!-- Se cargan dinámicamente -->
            </div>
        </div>
    </div>

    <!-- Modal Nueva PQR -->
    <div id="modal-pqr" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 w-full max-w-lg mx-4">
            <h3 class="text-2xl font-bold mb-6 text-gray-800">Nueva PQR</h3>
            <form id="form-nueva-pqr" class="space-y-4">
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Tipo</label>
                    <select id="nuevo-tipo-pqr" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500">
                        <option value="">Selecciona el tipo</option>
                        <option value="Petición">Petición</option>
                        <option value="Queja">Queja</option>
                        <option value="Reclamo">Reclamo</option>
                        <option value="Sugerencia">Sugerencia</option>
                    </select>
                </div>
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Asunto</label>
                    <input type="text" id="nuevo-asunto-pqr" required placeholder="Título del asunto"
                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500">
                </div>
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Descripción</label>
                    <textarea id="nueva-descripcion-pqr" required rows="4" placeholder="Describe detalladamente tu solicitud..."
                              class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500"></textarea>
                </div>
                <div class="flex space-x-4 pt-4">
                    <button type="button" onclick="document.getElementById('modal-pqr').classList.add('hidden')"
                            class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 rounded-lg transition-colors">
                        Cancelar
                    </button>
                    <button type="submit" class="flex-1 bg-orange-600 hover:bg-orange-700 text-white py-3 rounded-lg transition-colors">
                        Enviar PQR
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Permisos Section -->
    <div id="permisos-section" class="container mx-auto px-4 py-6 hidden">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-3xl font-bold text-gray-800">
                <i class="fas fa-shield-alt text-indigo-600 mr-3"></i>Gestión de Permisos
            </h2>
            <button onclick="document.getElementById('modal-permiso').classList.remove('hidden')"
                    class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-lg shadow-lg transition-colors">
                <i class="fas fa-plus mr-2"></i>Nuevo Permiso
            </button>
        </div>

        <div class="bg-white rounded-xl shadow-lg border border-gray-100 p-6">
            <div id="lista-permisos" class="space-y-4">
                <!-- Se cargan dinámicamente -->
            </div>
        </div>
    </div>

    <!-- Modal Nuevo Permiso -->
    <div id="modal-permiso" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 w-full max-w-lg mx-4">
            <h3 class="text-2xl font-bold mb-6 text-gray-800">Nuevo Permiso</h3>
            <form id="form-nuevo-permiso" class="space-y-4">
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Tipo de Permiso</label>
                    <select id="permiso-tipo" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                            onchange="togglePermisoFields()">
                        <option value="">Selecciona el tipo</option>
                        <option value="Entrada Personal">Entrada de Personal</option>
                        <option value="Salida Objeto">Salida de Objeto</option>
                        <option value="Entrada Visitante">Entrada de Visitante</option>
                        <option value="Trabajo Apartamento">Trabajo en Apartamento</option>
                    </select>
                </div>

                <div id="campos-persona" class="space-y-4 hidden">
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">Nombre Completo</label>
                        <input type="text" id="permiso-nombre" placeholder="Nombre de la persona"
                               class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">Cédula</label>
                        <input type="text" id="permiso-cedula" placeholder="Número de cédula"
                               class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                    </div>
                </div>

                <div id="campos-objeto" class="hidden">
                    <label class="block text-gray-700 font-medium mb-2">Descripción del Objeto</label>
                    <input type="text" id="permiso-objeto" placeholder="Describe el objeto a sacar"
                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                </div>

                <div>
                    <label class="block text-gray-700 font-medium mb-2">Vigencia</label>
                    <input type="date" id="permiso-vigencia" required
                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                </div>

                <div class="flex space-x-4 pt-4">
                    <button type="button" onclick="document.getElementById('modal-permiso').classList.add('hidden')"
                            class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 rounded-lg transition-colors">
                        Cancelar
                    </button>
                    <button type="submit" class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white py-3 rounded-lg transition-colors">
                        Crear Permiso
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Notification System -->
    <div id="notification-container" class="fixed top-4 right-4 z-50">
        <!-- Notificaciones se agregan dinámicamente aquí -->
    </div>

    <!-- Modal Chat Privado -->
    <div id="modal-chat-privado" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-xl w-full max-w-4xl mx-4 h-[80vh] flex flex-col">
            <!-- Header del Modal -->
            <div class="bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6 rounded-t-xl">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="w-12 h-12 bg-blue-800 rounded-full flex items-center justify-center">
                            <i class="fas fa-user-friends text-xl"></i>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold">Chat Privado</h3>
                            <p class="text-blue-100 text-sm">Conecta con residentes</p>
                        </div>
                    </div>
                    <button onclick="cerrarChatPrivado()"
                            class="w-8 h-8 bg-blue-800 hover:bg-blue-900 rounded-full flex items-center justify-center transition-colors">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>

            <!-- Contenido del Modal -->
            <div class="flex-1 flex overflow-hidden">
                <!-- Panel Izquierdo: Solicitudes y Notificaciones -->
                <div class="w-1/3 bg-gray-50 p-4 border-r">
                    <div class="space-y-4">
                        <!-- Solicitudes Pendientes -->
                        <div class="bg-white rounded-lg p-4 shadow-sm">
                            <div class="flex items-center justify-between mb-3">
                                <h4 class="font-semibold text-gray-800 flex items-center space-x-2">
                                    <i class="fas fa-bell text-yellow-500"></i>
                                    <span>Solicitudes Pendientes</span>
                                </h4>
                                <span id="solicitudes-count" class="bg-red-500 text-white text-xs px-2 py-1 rounded-full">0</span>
                            </div>
                            <div id="lista-solicitudes" class="space-y-2 max-h-40 overflow-y-auto">
                                <!-- Solicitudes se cargan dinámicamente -->
                            </div>
                        </div>

                        <!-- Mis Chats Activos -->
                        <div class="bg-white rounded-lg p-4 shadow-sm">
                            <h4 class="font-semibold text-gray-800 mb-3 flex items-center space-x-2">
                                <i class="fas fa-comments text-green-500"></i>
                                <span>Chats Activos</span>
                            </h4>
                            <div id="lista-chats-activos" class="space-y-2 max-h-40 overflow-y-auto">
                                <!-- Chats activos se cargan dinámicamente -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Panel Derecho: Selector de Apartamentos -->
                <div class="flex-1 p-6 overflow-y-auto">
                    <div class="max-w-2xl mx-auto">
                        <div class="text-center mb-6">
                            <h4 class="text-xl font-bold text-gray-800 mb-2">Seleccionar Residente</h4>
                            <p class="text-gray-600">Elige el apartamento con quien deseas iniciar una conversación</p>
                        </div>

                        <!-- Selector por Torres -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <!-- Torre 1 -->
                            <div class="bg-white border border-gray-200 rounded-xl overflow-hidden shadow-sm hover:shadow-md transition-shadow">
                                <div class="bg-gradient-to-r from-purple-500 to-purple-600 text-white p-4 text-center">
                                    <i class="fas fa-building text-2xl mb-2"></i>
                                    <h5 class="font-bold text-lg">Torre 1</h5>
                                </div>
                                <div id="apartamentos-torre-1" class="p-4 space-y-2">
                                    <!-- Apartamentos de Torre 1 se cargan dinámicamente -->
                                </div>
                            </div>

                            <!-- Torre 2 -->
                            <div class="bg-white border border-gray-200 rounded-xl overflow-hidden shadow-sm hover:shadow-md transition-shadow">
                                <div class="bg-gradient-to-r from-indigo-500 to-indigo-600 text-white p-4 text-center">
                                    <i class="fas fa-building text-2xl mb-2"></i>
                                    <h5 class="font-bold text-lg">Torre 2</h5>
                                </div>
                                <div id="apartamentos-torre-2" class="p-4 space-y-2">
                                    <!-- Apartamentos de Torre 2 se cargan dinámicamente -->
                                </div>
                            </div>

                            <!-- Torre 3 -->
                            <div class="bg-white border border-gray-200 rounded-xl overflow-hidden shadow-sm hover:shadow-md transition-shadow">
                                <div class="bg-gradient-to-r from-teal-500 to-teal-600 text-white p-4 text-center">
                                    <i class="fas fa-building text-2xl mb-2"></i>
                                    <h5 class="font-bold text-lg">Torre 3</h5>
                                </div>
                                <div id="apartamentos-torre-3" class="p-4 space-y-2">
                                    <!-- Apartamentos de Torre 3 se cargan dinámicamente -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Solicitar Chat -->
    <div id="modal-solicitar-chat" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-6 w-full max-w-md mx-4">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-paper-plane text-blue-600 text-2xl"></i>
                </div>
                <h3 class="text-xl font-bold text-gray-800 mb-2">Solicitar Chat</h3>
                <p id="destinatario-info" class="text-gray-600"></p>
            </div>

            <form id="form-solicitar-chat" class="space-y-4">
                <div>
                    <label class="block text-gray-700 font-medium mb-2">Mensaje de presentación</label>
                    <textarea id="mensaje-solicitud" required rows="4"
                              placeholder="Hola, me gustaría conversar contigo..."
                              class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 resize-none"></textarea>
                </div>

                <div class="flex space-x-3 pt-4">
                    <button type="button" onclick="cerrarModalSolicitud()"
                            class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 rounded-lg transition-colors">
                        Cancelar
                    </button>
                    <button type="submit"
                            class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg transition-colors">
                        Enviar Solicitud
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Noticias -->
    <div id="modal-noticias" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-xl w-full max-w-4xl mx-4 h-[85vh] flex flex-col">
            <!-- Header del Modal -->
            <div class="bg-gradient-to-r from-green-600 to-green-700 text-white p-6 rounded-t-xl">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="w-12 h-12 bg-green-800 rounded-full flex items-center justify-center">
                            <i class="fas fa-newspaper text-xl"></i>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold">Noticias del Conjunto</h3>
                            <p class="text-green-100 text-sm">Mantente informado de todos los eventos</p>
                        </div>
                    </div>
                    <button onclick="cerrarModalNoticias()"
                            class="w-8 h-8 bg-green-800 hover:bg-green-900 rounded-full flex items-center justify-center transition-colors">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>

            <!-- Filtros y Search -->
            <div class="p-4 border-b border-gray-200">
                <div class="flex flex-wrap gap-3 items-center">
                    <div class="flex space-x-2">
                        <button onclick="filtrarNoticias('todas')"
                                class="filtro-noticia active px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800">
                            Todas
                        </button>
                        <button onclick="filtrarNoticias('Administrativo')"
                                class="filtro-noticia px-3 py-1 rounded-full text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200">
                            Administrativo
                        </button>
                        <button onclick="filtrarNoticias('Social')"
                                class="filtro-noticia px-3 py-1 rounded-full text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200">
                            Social
                        </button>
                        <button onclick="filtrarNoticias('Mantenimiento')"
                                class="filtro-noticia px-3 py-1 rounded-full text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200">
                            Mantenimiento
                        </button>
                        <button onclick="filtrarNoticias('Seguridad')"
                                class="filtro-noticia px-3 py-1 rounded-full text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200">
                            Seguridad
                        </button>
                    </div>
                </div>
            </div>

            <!-- Lista de Noticias -->
            <div class="flex-1 overflow-y-auto p-6">
                <div id="lista-noticias" class="space-y-4">
                    <!-- Noticias se cargan dinámicamente -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Detalle Noticia -->
    <div id="modal-detalle-noticia" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-xl w-full max-w-2xl mx-4 max-h-[80vh] overflow-y-auto">
            <div id="detalle-noticia-content">
                <!-- Contenido se carga dinámicamente -->
            </div>
        </div>
    </div>

    <!-- Modal Nuevo Arriendo -->
    <div id="modal-nuevo-arriendo" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-xl w-full max-w-2xl mx-4 max-h-[80vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-bold text-gray-800">Registrar Nuevo Arriendo</h3>
                    <button onclick="cerrarModalNuevoArriendo()" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>

                <form id="form-nuevo-arriendo" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tipo de Propiedad</label>
                            <select id="tipo-propiedad" class="w-full p-3 border border-gray-300 rounded-lg">
                                <option value="apartamento">Apartamento</option>
                                <option value="parqueadero">Parqueadero</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Torre/Nivel</label>
                            <select id="torre-nivel" class="w-full p-3 border border-gray-300 rounded-lg">
                                <option value="">Seleccionar...</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Número</label>
                            <input type="text" id="numero-propiedad" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="Ej: 401A o P-15">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Precio Mensual</label>
                            <input type="number" id="precio-arriendo" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="1200000">
                        </div>
                    </div>

                    <div id="campos-apartamento" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Habitaciones</label>
                            <input type="number" id="habitaciones" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="3">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Baños</label>
                            <input type="number" id="banos" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="2">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Área (m²)</label>
                            <input type="number" id="area" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="85">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Descripción</label>
                        <textarea id="descripcion-arriendo" rows="3" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="Descripción del inmueble..."></textarea>
                    </div>

                    <div class="flex space-x-4 pt-4">
                        <button type="button" onclick="cerrarModalNuevoArriendo()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 rounded-lg">
                            Cancelar
                        </button>
                        <button type="submit" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg">
                            Registrar Arriendo
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Sorteo Parqueaderos -->
    <div id="modal-sorteo-parqueaderos" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-xl w-full max-w-4xl mx-4 max-h-[80vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-bold text-gray-800">Sorteo de Parqueaderos (100 Espacios)</h3>
                    <button onclick="cerrarModalSorteoParqueaderos()" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Configuración del Sorteo -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-gray-800">Configuración del Sorteo</h4>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nivel de Parqueaderos</label>
                            <select id="nivel-sorteo" class="w-full p-3 border border-gray-300 rounded-lg">
                                <option value="Sótano 1">Sótano 1 (P-001 a P-033)</option>
                                <option value="Sótano 2">Sótano 2 (P-034 a P-066)</option>
                                <option value="Sótano 3">Sótano 3 (P-067 a P-100)</option>
                                <option value="todos">Todos los Niveles (P-001 a P-100)</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Número de Participantes</label>
                            <input type="number" id="num-participantes" class="w-full p-3 border border-gray-300 rounded-lg"
                                   value="50" min="1" max="100" placeholder="Máximo 100">
                        </div>

                        <div class="space-y-2">
                            <button onclick="generarParticipantesSorteo()" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg">
                                <i class="fas fa-users mr-2"></i>Generar Lista de Participantes
                            </button>
                            <button onclick="realizarSorteoParqueaderos()" class="w-full bg-purple-600 hover:bg-purple-700 text-white py-3 rounded-lg">
                                <i class="fas fa-dice mr-2"></i>Realizar Sorteo
                            </button>
                        </div>
                    </div>

                    <!-- Resultados del Sorteo -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-gray-800">Resultados del Sorteo</h4>
                        <div id="resultados-sorteo" class="border border-gray-200 rounded-lg p-4 min-h-[300px] bg-gray-50">
                            <p class="text-gray-500 text-center">Los resultados aparecerán aquí después del sorteo</p>
                        </div>

                        <button onclick="descargarResultadosSorteo()" class="w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg disabled:opacity-50" disabled id="btn-descargar-sorteo">
                            <i class="fas fa-download mr-2"></i>Descargar Resultados
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Ingreso Vehículo -->
    <div id="modal-ingreso-vehiculo" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-xl w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-bold text-gray-800">Control de Ingreso de Vehículos</h3>
                    <button onclick="cerrarModalIngresoVehiculo()" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Formulario de Registro -->
                    <div>
                        <h4 class="text-lg font-semibold text-gray-800 mb-4">Registrar Nuevo Ingreso</h4>

                        <form id="form-ingreso-vehiculo" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Placa del Vehículo</label>
                                <input type="text" id="placa-vehiculo" class="w-full p-3 border border-gray-300 rounded-lg uppercase"
                                       placeholder="ABC123" maxlength="6" style="text-transform: uppercase;">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Nombre del Visitante</label>
                                <input type="text" id="nombre-visitante" class="w-full p-3 border border-gray-300 rounded-lg"
                                       placeholder="Juan Pérez">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Apartamento que Visita</label>
                                <select id="apartamento-visita" class="w-full p-3 border border-gray-300 rounded-lg">
                                    <option value="">Seleccionar apartamento...</option>
                                    <!-- Se llenan dinámicamente -->
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Tipo de Vehículo</label>
                                <select id="tipo-vehiculo" class="w-full p-3 border border-gray-300 rounded-lg">
                                    <option value="automovil">Automóvil</option>
                                    <option value="motocicleta">Motocicleta</option>
                                    <option value="camioneta">Camioneta</option>
                                </select>
                            </div>

                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                <h4 class="font-semibold text-blue-800 mb-2">Información de Tarifas</h4>
                                <ul class="text-sm text-blue-700 space-y-1">
                                    <li>• Primeras 2 horas: <strong>GRATIS</strong></li>
                                    <li>• Hora 3 en adelante: <strong>$1,000/hora</strong></li>
                                    <li>• Después de 15 horas: <strong>$12,000 tarifa plana</strong></li>
                                </ul>
                            </div>

                            <div class="flex space-x-4 pt-4">
                                <button type="button" onclick="cerrarModalIngresoVehiculo()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 rounded-lg">
                                    Cancelar
                                </button>
                                <button type="submit" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg">
                                    Registrar Ingreso
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Último Registro y Historial -->
                    <div>
                        <h4 class="text-lg font-semibold text-gray-800 mb-4">Último Registro</h4>

                        <div id="ultimo-registro-vehiculo" class="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
                            <p class="text-gray-500 text-center">No hay registros recientes</p>
                        </div>

                        <h4 class="text-lg font-semibold text-gray-800 mb-4">Historial de Ingresos Hoy</h4>

                        <div id="historial-ingresos-hoy" class="border border-gray-200 rounded-lg p-4 max-h-80 overflow-y-auto bg-gray-50">
                            <p class="text-gray-500 text-center">Cargando historial...</p>
                        </div>

                        <div class="mt-4">
                            <button onclick="actualizarHistorialIngresos()" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg">
                                <i class="fas fa-sync mr-2"></i>Actualizar Historial
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <style>
        .nav-btn {
            padding: 0.75rem 1rem;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s ease;
            border-radius: 0.5rem;
            margin: 0 0.25rem;
            white-space: nowrap;
            color: rgba(255, 255, 255, 0.8);
        }

        .nav-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .nav-btn.active {
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            font-weight: 600;
        }

        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }

        .chat-message {
            max-width: 70%;
            word-wrap: break-word;
        }

        .chat-message.sent {
            background-color: #10b981;
            color: white;
            margin-left: auto;
            border-radius: 0.5rem;
            border-bottom-right-radius: 0.125rem;
        }

        .chat-message.received {
            background-color: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            border-bottom-left-radius: 0.125rem;
        }

        .chat-type-btn.active {
            background-color: #166534;
            color: white;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        .slide-up {
            animation: slideUp 0.3s ease-out;
        }

        .notification {
            background-color: white;
            border-left: 4px solid #3b82f6;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            padding: 1rem;
            margin-bottom: 0.75rem;
            max-width: 24rem;
            transform: translateX(0);
            transition: all 0.3s ease;
        }

        .notification.success {
            border-left-color: #10b981;
        }

        .notification.error {
            border-left-color: #ef4444;
        }

        .notification.warning {
            border-left-color: #f59e0b;
        }

        .notification.info {
            border-left-color: #3b82f6;
        }

        /* Estilos para el Calendario de Reservas */
        .calendar-view {
            min-height: 400px;
        }

        .calendar-day {
            border: 1px solid #e5e7eb;
            min-height: 60px;
            padding: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .calendar-day:hover {
            background-color: #f3f4f6;
        }

        .calendar-day.today {
            background-color: #dbeafe;
            border-color: #3b82f6;
        }

        .calendar-day.selected {
            background-color: #3b82f6;
            color: white;
        }

        .calendar-day.disabled {
            background-color: #f9fafb;
            color: #9ca3af;
            cursor: not-allowed;
        }

        .calendar-day.has-reservation {
            background-color: #fef3c7;
            border-color: #f59e0b;
        }

        .space-selector.selected {
            border-color: #3b82f6 !important;
            background-color: #dbeafe !important;
        }

        .space-option.selected {
            border-color: #3b82f6 !important;
            background-color: #dbeafe !important;
        }

        .time-slot {
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 8px;
        }

        .time-slot:hover {
            border-color: #3b82f6;
            background-color: #f8fafc;
        }

        .time-slot.selected {
            border-color: #3b82f6;
            background-color: #dbeafe;
            color: #1e3a8a;
        }

        .time-slot.occupied {
            background-color: #fee2e2;
            border-color: #ef4444;
            color: #7f1d1d;
            cursor: not-allowed;
        }

        .time-slot.occupied:hover {
            border-color: #ef4444;
            background-color: #fee2e2;
        }

        .calendar-time-grid {
            display: grid;
            grid-template-columns: 100px repeat(7, 1fr);
            gap: 1px;
            background-color: #e5e7eb;
        }

        .calendar-time-slot {
            background-color: white;
            padding: 8px;
            min-height: 40px;
            border: 1px solid #e5e7eb;
            position: relative;
            cursor: pointer;
        }

        .calendar-time-slot:hover {
            background-color: #f3f4f6;
        }

        .calendar-time-slot.occupied {
            background-color: #fecaca;
            cursor: not-allowed;
        }

        .calendar-time-slot.selected-space {
            background-color: #bfdbfe;
        }

        .reservation-block {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 12px;
            position: absolute;
            top: 2px;
            left: 2px;
            right: 2px;
            bottom: 2px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .mini-calendar-day {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
        }

        .mini-calendar-day:hover {
            background-color: #e5e7eb;
        }

        .mini-calendar-day.today {
            background-color: #3b82f6;
            color: white;
        }

        .mini-calendar-day.selected {
            background-color: #1d4ed8;
            color: white;
        }

        .mini-calendar-day.disabled {
            color: #9ca3af;
            cursor: not-allowed;
        }

        .mini-calendar-day.disabled:hover {
            background-color: transparent;
        }

        /* Estilos para time slots del calendario */
        .time-slot {
            border: 1px solid #e5e7eb;
            border-right: 1px solid #e5e7eb;
            min-height: 50px;
            padding: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 500;
        }

        .time-slot.available {
            background-color: #f0fdf4;
            border-color: #16a34a;
            color: #16a34a;
        }

        .time-slot.available:hover {
            background-color: #dcfce7;
            border-color: #15803d;
            transform: scale(1.02);
        }

        .time-slot.reserved {
            background-color: #fef2f2;
            border-color: #dc2626;
            color: #dc2626;
            cursor: not-allowed;
        }

        .time-slot.selected {
            background-color: #3b82f6;
            border-color: #1d4ed8;
            color: white;
            font-weight: 600;
        }

        .time-slot.selected::after {
            content: "✓";
            font-size: 16px;
            font-weight: bold;
        }

        /* Estilos para tarjetas de espacios */
        .espacio-card {
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            background: white;
        }

        .espacio-card:hover {
            border-color: #3b82f6;
            background-color: #f8fafc;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        }

        .espacio-card.selected {
            border-color: #3b82f6;
            background-color: #eff6ff;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
        }

        /* Estilos para indicadores de progreso */
        .step-indicator.active .w-8 {
            background-color: white;
            color: #3b82f6;
        }

        .step-indicator:not(.active) .w-8 {
            background-color: #6366f1;
            color: white;
        }


        .filtro-noticia.active {
            background-color: #dcfce7 !important;
            color: #166534 !important;
        }
    </style>

    <script>
        // Datos simulados de la aplicación
        let appData = {
            reservas: [
                { id: 1, espacio: 'Salón Comunal', fecha: '2025-08-15', hora: '10:00', usuario: 'María García - Apto 202' },
                { id: 2, espacio: 'Gimnasio', fecha: '2025-08-14', hora: '06:00', usuario: 'Carlos López - Apto 305' }
            ],
            pagos: [
                { id: 1, concepto: 'Administración', valor: 450000, mes: 'Agosto 2025', estado: 'pendiente', vencimiento: '2025-08-15' },
                { id: 2, concepto: 'Parqueadero', valor: 80000, mes: 'Agosto 2025', estado: 'pagado', vencimiento: '2025-08-15' },
                { id: 3, concepto: 'Administración', valor: 450000, mes: 'Julio 2025', estado: 'pagado', vencimiento: '2025-07-15' }
            ],
            mensajes: [
                { id: 1, usuario: 'Admin Conjunto', mensaje: 'Recordamos que mañana habrá mantenimiento del ascensor Torre B', fecha: '2025-08-12 09:00', tipo: 'administracion' },
                { id: 2, usuario: 'Ana Martínez - 501B', mensaje: '¿Alguien sabe hasta qué hora estará cerrada la piscina?', fecha: '2025-08-12 14:30', tipo: 'general' },
                { id: 3, usuario: 'Pedro Gómez - 201A', mensaje: 'Buenas tardes, la puerta del gimnasio está haciendo ruido', fecha: '2025-08-12 16:45', tipo: 'general' }
            ],
            emprendimientos: [
                { id: 1, nombre: 'Delicias Caseras', propietario: 'Laura Ruiz - 203A', tipo: 'Comida', telefono: '300-123-4567', descripcion: 'Postres y comida casera', imagen: 'https://via.placeholder.com/300x200?text=Delicias+Caseras' },
                { id: 2, nombre: 'TecniFix', propietario: 'Miguel Santos - 302B', tipo: 'Técnico', telefono: '301-987-6543', descripcion: 'Reparación de electrodomésticos', imagen: 'https://via.placeholder.com/300x200?text=TecniFix' },
                { id: 3, nombre: 'Belleza en Casa', propietario: 'Carmen Torres - 104C', tipo: 'Belleza', telefono: '302-555-0123', descripcion: 'Servicios de manicure y pedicure a domicilio', imagen: 'https://via.placeholder.com/300x200?text=Belleza+en+Casa' }
            ],
            pqrs: [
                { id: 1, tipo: 'Reclamo', asunto: 'Ruido nocturno Torre B', estado: 'En proceso', fecha: '2025-08-10', descripcion: 'Se reportan ruidos excesivos durante las noches en el piso 5 de la Torre B' },
                { id: 2, tipo: 'Petición', asunto: 'Solicitud nueva máquina gimnasio', estado: 'Pendiente', fecha: '2025-08-08', descripcion: 'Solicito considerar la compra de una nueva máquina elíptica para el gimnasio' }
            ],
            permisos: [
                { id: 1, tipo: 'Entrada Personal', nombre: 'María Trabajadora', cedula: '12345678', fecha: '2025-08-12', vigencia: '2025-08-15' },
                { id: 2, tipo: 'Salida Objeto', objeto: 'Televisor Samsung 55"', autorizado: 'Juan Pérez', fecha: '2025-08-11', vigencia: '2025-08-11' }
            ]
        };

        let tipoChat = 'general';

        // Función principal para mostrar secciones
        function mostrarSeccion(seccion) {
            // Ocultar todas las secciones
            const secciones = ['dashboard', 'reservas', 'pagos', 'chat', 'emprendimientos', 'pqr', 'permisos', 'arriendos', 'parqueaderos', 'vehiculos'];
            secciones.forEach(sec => {
                const elemento = document.getElementById(`${sec}-section`);
                if (elemento) {
                    elemento.classList.add('hidden');
                }
            });

            // Remover clase active de todos los botones
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Mostrar la sección seleccionada
            const seccionElement = document.getElementById(`${seccion}-section`);
            if (seccionElement) {
                seccionElement.classList.remove('hidden');
                seccionElement.classList.add('fade-in');
            }

            // Agregar clase active al botón correspondiente
            document.querySelector(`[data-section="${seccion}"]`)?.classList.add('active');

            // Actualizar título de la página
            const titles = {
                dashboard: 'Dashboard',
                reservas: 'Reservas',
                pagos: 'Pagos',
                chat: 'Chat Comunidad',
                emprendimientos: 'Emprendimientos',
                pqr: 'PQR',
                permisos: 'Permisos',
                arriendos: 'Apartamentos en Arriendo',
                parqueaderos: 'Parqueaderos',
                vehiculos: 'Control de Vehículos'
            };

            // Cargar contenido específico de cada sección
            switch(seccion) {
                case 'dashboard':
                    cargarDashboard();
                    break;
                case 'reservas':
                    cargarReservas();
                    break;
                case 'pagos':
                    cargarPagos();
                    break;
                case 'chat':
                    cargarChat();
                    // Actualizar badge de notificaciones de chat privado
                    setTimeout(actualizarBadgeChatPrivado, 500);
                    break;
                case 'emprendimientos':
                    cargarEmprendimientos();
                    break;
                case 'pqr':
                    cargarPQR();
                    break;
                case 'permisos':
                    cargarPermisos();
                    break;
                case 'arriendos':
                    cargarArriendos();
                    break;
                case 'parqueaderos':
                    cargarParqueaderos();
                    break;
                case 'vehiculos':
                    cargarVehiculos();
                    break;
            }
        }

        // Función para cargar dashboard
        async function cargarDashboard() {
            try {
                // Simular carga de datos
                const [reservas, pagos, mensajes, pqrs] = await Promise.all([
                    Promise.resolve({data: {reservas: appData.reservas}}),
                    Promise.resolve({data: {pagos: appData.pagos}}),
                    Promise.resolve({data: {mensajes: appData.mensajes}}),
                    Promise.resolve({data: {pqrs: appData.pqrs}})
                ]);

                // Actualizar estadísticas
                document.getElementById('total-reservas').textContent = reservas.data.reservas.length;

                const totalPendiente = pagos.data.pagos
                    .filter(p => p.estado === 'pendiente')
                    .reduce((sum, p) => sum + p.valor, 0);
                document.getElementById('pagos-pendientes').textContent = `$${totalPendiente.toLocaleString()}`;

                document.getElementById('mensajes-nuevos').textContent = mensajes.data.mensajes.length;
                document.getElementById('pqr-abiertas').textContent = pqrs.data.pqrs.filter(p => p.estado !== 'Resuelto').length;

                // Cargar actividad reciente
                const container = document.getElementById('recent-activity');
                container.innerHTML = `
                    <div class="flex items-center p-4 bg-blue-50 rounded-lg border border-blue-200">
                        <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center mr-4">
                            <i class="fas fa-calendar text-white"></i>
                        </div>
                        <div class="flex-1">
                            <p class="font-medium text-gray-800">Nueva reserva creada</p>
                            <p class="text-sm text-gray-600">Salón Comunal - 15 de Agosto</p>
                        </div>
                        <span class="text-sm text-gray-500">Hace 2 horas</span>
                    </div>
                    <div class="flex items-center p-4 bg-green-50 rounded-lg border border-green-200">
                        <div class="w-10 h-10 bg-green-500 rounded-full flex items-center justify-center mr-4">
                            <i class="fas fa-check text-white"></i>
                        </div>
                        <div class="flex-1">
                            <p class="font-medium text-gray-800">Pago procesado</p>
                            <p class="text-sm text-gray-600">Parqueadero - Agosto 2025</p>
                        </div>
                        <span class="text-sm text-gray-500">Ayer</span>
                    </div>
                    <div class="flex items-center p-4 bg-purple-50 rounded-lg border border-purple-200">
                        <div class="w-10 h-10 bg-purple-500 rounded-full flex items-center justify-center mr-4">
                            <i class="fas fa-comment text-white"></i>
                        </div>
                        <div class="flex-1">
                            <p class="font-medium text-gray-800">Nuevo mensaje en chat</p>
                            <p class="text-sm text-gray-600">Ana pregunta sobre la piscina</p>
                        </div>
                        <span class="text-sm text-gray-500">Hace 3 horas</span>
                    </div>
                `;

                // Cargar noticias
                await cargarNoticias();

            } catch (error) {
                console.error('Error cargando dashboard:', error);
                mostrarNotificacion('Error cargando el dashboard', 'error');
            }
        }

        // Función para cargar reservas
        async function cargarReservas() {
            const container = document.getElementById('lista-reservas');
            container.innerHTML = '';

            appData.reservas.forEach(reserva => {
                const reservaElement = document.createElement('div');
                reservaElement.className = 'flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-200 hover:shadow-md transition-shadow';
                reservaElement.innerHTML = `
                    <div class="flex items-center space-x-4">
                        <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-calendar text-blue-600"></i>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-800">${reserva.espacio}</h4>
                            <p class="text-sm text-gray-600">${reserva.fecha} a las ${reserva.hora}</p>
                            <p class="text-xs text-gray-500">${reserva.usuario}</p>
                        </div>
                    </div>
                    <div class="flex space-x-2">
                        <button onclick="editarReserva(${reserva.id})" class="text-blue-600 hover:text-blue-800">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="eliminarReserva(${reserva.id})" class="text-red-600 hover:text-red-800">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                container.appendChild(reservaElement);
            });
        }

        // Función para cargar pagos
        async function cargarPagos() {
            const container = document.getElementById('lista-pagos');
            container.innerHTML = '';

            appData.pagos.forEach(pago => {
                const pagoElement = document.createElement('div');
                pagoElement.className = 'flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-200 hover:shadow-md transition-shadow';

                const estadoColor = pago.estado === 'pagado' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800';
                const estadoIcon = pago.estado === 'pagado' ? 'fa-check-circle' : 'fa-clock';

                pagoElement.innerHTML = `
                    <div class="flex items-center space-x-4">
                        <div class="w-12 h-12 ${pago.estado === 'pagado' ? 'bg-green-100' : 'bg-red-100'} rounded-lg flex items-center justify-center">
                            <i class="fas ${estadoIcon} ${pago.estado === 'pagado' ? 'text-green-600' : 'text-red-600'}"></i>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-800">${pago.concepto}</h4>
                            <p class="text-sm text-gray-600">${pago.mes}</p>
                            <p class="text-lg font-bold text-gray-800">$${pago.valor.toLocaleString()}</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <span class="px-3 py-1 rounded-full text-sm ${estadoColor}">${pago.estado}</span>
                        <p class="text-xs text-gray-500 mt-1">Vence: ${pago.vencimiento}</p>
                        ${pago.estado === 'pendiente' ?
                            `<button onclick="marcarComoPagado(${pago.id})"
                                     class="mt-2 bg-green-600 hover:bg-green-700 text-white px-4 py-1 rounded text-sm transition-colors">
                                Marcar como Pagado
                             </button>` : ''
                        }
                    </div>
                `;
                container.appendChild(pagoElement);
            });
        }

        // Función para cargar chat
        function cargarChat() {
            const container = document.getElementById('chat-messages');
            container.innerHTML = '';

            const mensajesFiltrados = appData.mensajes.filter(m => m.tipo === tipoChat);

            mensajesFiltrados.forEach(mensaje => {
                const esPropio = mensaje.usuario.includes('Juan Pérez'); // Simular usuario actual
                const mensajeDiv = document.createElement('div');
                mensajeDiv.className = `chat-message p-3 mb-3 ${esPropio ? 'sent' : 'received'}`;

                mensajeDiv.innerHTML = `
                    ${!esPropio ? `<p class="text-xs text-gray-600 mb-1">${mensaje.usuario}</p>` : ''}
                    <p class="text-sm">${mensaje.mensaje}</p>
                    <p class="text-xs ${esPropio ? 'text-green-200' : 'text-gray-500'} mt-1">${mensaje.fecha}</p>
                `;

                container.appendChild(mensajeDiv);
            });

            // Scroll al final
            container.scrollTop = container.scrollHeight;
        }

        // Función para seleccionar tipo de chat
        function seleccionarTipoChat(tipo) {
            tipoChat = tipo;

            // Actualizar botones
            document.querySelectorAll('.chat-type-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.classList.add('bg-green-700', 'hover:bg-green-800');
                btn.classList.remove('bg-green-800');
            });

            // Encontrar y activar el botón correcto basado en el tipo
            const targetBtn = document.querySelector(`[onclick="seleccionarTipoChat('${tipo}')"]`);
            if (targetBtn) {
                targetBtn.classList.add('active');
                targetBtn.classList.remove('bg-green-700', 'hover:bg-green-800');
                targetBtn.classList.add('bg-green-800');
            }

            cargarChat();
        }

        // Función para cargar emprendimientos
        function cargarEmprendimientos() {
            const container = document.getElementById('lista-emprendimientos');
            container.innerHTML = '';

            appData.emprendimientos.forEach(emp => {
                const empElement = document.createElement('div');
                empElement.className = 'bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden hover:shadow-xl transition-shadow';
                empElement.innerHTML = `
                    <div class="h-48 bg-gradient-to-r from-purple-400 to-pink-400"></div>
                    <div class="p-6">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="text-xl font-bold text-gray-800">${emp.nombre}</h3>
                            <span class="px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded-full">${emp.tipo}</span>
                        </div>
                        <p class="text-gray-600 mb-2">${emp.propietario}</p>
                        <p class="text-sm text-gray-700 mb-4">${emp.descripcion}</p>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center text-green-600">
                                <i class="fas fa-phone mr-2"></i>
                                <span class="text-sm font-medium">${emp.telefono}</span>
                            </div>
                            <button class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg text-sm transition-colors">
                                Contactar
                            </button>
                        </div>
                    </div>
                `;
                container.appendChild(empElement);
            });
        }

        // Función para cargar PQR
        function cargarPQR() {
            const container = document.getElementById('lista-pqr');
            container.innerHTML = '';

            appData.pqrs.forEach(pqr => {
                const pqrElement = document.createElement('div');
                pqrElement.className = 'p-4 bg-gray-50 rounded-lg border border-gray-200 hover:shadow-md transition-shadow';

                const estadoColor = {
                    'Pendiente': 'bg-yellow-100 text-yellow-800',
                    'En proceso': 'bg-blue-100 text-blue-800',
                    'Resuelto': 'bg-green-100 text-green-800'
                };

                pqrElement.innerHTML = `
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-file-alt text-orange-600"></i>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-800">${pqr.asunto}</h4>
                                <p class="text-sm text-gray-600">${pqr.tipo} - ${pqr.fecha}</p>
                            </div>
                        </div>
                        <span class="px-3 py-1 rounded-full text-sm ${estadoColor[pqr.estado]}">${pqr.estado}</span>
                    </div>
                    <p class="text-sm text-gray-700">${pqr.descripcion}</p>
                `;
                container.appendChild(pqrElement);
            });
        }

        // Función para cargar permisos
        function cargarPermisos() {
            const container = document.getElementById('lista-permisos');
            container.innerHTML = '';

            appData.permisos.forEach(permiso => {
                const permisoElement = document.createElement('div');
                permisoElement.className = 'flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-200 hover:shadow-md transition-shadow';

                const vigente = new Date(permiso.vigencia) >= new Date();
                const estadoColor = vigente ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800';

                permisoElement.innerHTML = `
                    <div class="flex items-center space-x-4">
                        <div class="w-12 h-12 bg-indigo-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-shield-alt text-indigo-600"></i>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-800">${permiso.tipo}</h4>
                            <p class="text-sm text-gray-600">
                                ${permiso.nombre || permiso.objeto}
                                ${permiso.cedula ? `- ${permiso.cedula}` : ''}
                            </p>
                            <p class="text-xs text-gray-500">Creado: ${permiso.fecha} | Vigencia: ${permiso.vigencia}</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <span class="px-3 py-1 rounded-full text-sm ${estadoColor}">
                            ${vigente ? 'Vigente' : 'Vencido'}
                        </span>
                        <button onclick="eliminarPermiso(${permiso.id})"
                                class="ml-2 text-red-600 hover:text-red-800">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                container.appendChild(permisoElement);
            });
        }

        // Función para cargar módulo de arriendos
        async function cargarArriendos() {
            try {
                const response = await fetch('/api/apartamentos-arriendo', {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    }
                });

                if (response.ok) {
                    const apartamentos = await response.json();
                    mostrarApartamentosArriendo(apartamentos);
                } else {
                    console.error('Error al cargar apartamentos en arriendo');
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        // Función para cargar módulo de parqueaderos
        async function cargarParqueaderos() {
            try {
                const response = await fetch('/api/parqueaderos', {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    }
                });

                if (response.ok) {
                    const parqueaderos = await response.json();
                    mostrarParqueaderos(parqueaderos);
                } else {
                    console.error('Error al cargar parqueaderos');
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        // Función para cargar módulo de control de vehículos
        async function cargarVehiculos() {
            try {
                const response = await fetch('/api/vehiculos-visitantes', {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    }
                });

                if (response.ok) {
                    const vehiculos = await response.json();
                    mostrarVehiculosVisitantes(vehiculos);
                } else {
                    console.error('Error al cargar vehículos visitantes');
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        // Función para mostrar apartamentos en arriendo
        function mostrarApartamentosArriendo(apartamentos) {
            const container = document.getElementById('lista-apartamentos-arriendo');
            if (!container) return;

            container.innerHTML = '';

            apartamentos.forEach(apartamento => {
                const apartamentoCard = document.createElement('div');
                apartamentoCard.className = 'bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow';

                const disponible = apartamento.estado === 'disponible';
                const estadoColor = disponible ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800';

                apartamentoCard.innerHTML = `
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">${apartamento.torre} - Apto ${apartamento.numero}</h3>
                        <span class="px-3 py-1 rounded-full text-sm ${estadoColor}">
                            ${apartamento.estado === 'disponible' ? 'Disponible' : 'Ocupado'}
                        </span>
                    </div>

                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <p class="text-sm text-gray-600">Habitaciones</p>
                            <p class="font-medium">${apartamento.habitaciones}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Baños</p>
                            <p class="font-medium">${apartamento.banos}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Área</p>
                            <p class="font-medium">${apartamento.area} m²</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Precio</p>
                            <p class="font-medium text-green-600">$${apartamento.precio.toLocaleString()}</p>
                        </div>
                    </div>

                    ${apartamento.inquilino ? `
                        <div class="border-t pt-4">
                            <p class="text-sm text-gray-600">Inquilino actual:</p>
                            <p class="font-medium">${apartamento.inquilino}</p>
                            <p class="text-sm text-gray-500">Contrato hasta: ${apartamento.fechaFinContrato}</p>
                        </div>
                    ` : ''}
                `;

                container.appendChild(apartamentoCard);
            });
        }

        // Función para mostrar parqueaderos
        function mostrarParqueaderos(parqueaderos) {
            const container = document.getElementById('lista-parqueaderos');
            if (!container) return;

            container.innerHTML = '';

            parqueaderos.forEach(parqueadero => {
                const parqueaderoCard = document.createElement('div');
                parqueaderoCard.className = 'bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow';

                const disponible = parqueadero.estado === 'disponible';
                const estadoColor = disponible ? 'bg-green-100 text-green-800' : 'bg-orange-100 text-orange-800';

                parqueaderoCard.innerHTML = `
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">Parqueadero ${parqueadero.numero}</h3>
                        <span class="px-3 py-1 rounded-full text-sm ${estadoColor}">
                            ${parqueadero.estado === 'disponible' ? 'Disponible' : 'Asignado'}
                        </span>
                    </div>

                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <p class="text-sm text-gray-600">Nivel</p>
                            <p class="font-medium">${parqueadero.nivel}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Tipo</p>
                            <p class="font-medium">${parqueadero.tipo}</p>
                        </div>
                    </div>

                    ${parqueadero.apartamento ? `
                        <div class="border-t pt-4">
                            <p class="text-sm text-gray-600">Asignado a:</p>
                            <p class="font-medium">${parqueadero.apartamento}</p>
                        </div>
                    ` : ''}
                `;

                container.appendChild(parqueaderoCard);
            });
        }

        // Función para mostrar vehículos visitantes
        function mostrarVehiculosVisitantes(vehiculos) {
            const container = document.getElementById('lista-vehiculos-visitantes');
            if (!container) return;

            container.innerHTML = '';

            vehiculos.forEach(vehiculo => {
                const vehiculoCard = document.createElement('div');
                vehiculoCard.className = 'bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow';

                const activo = vehiculo.activo;
                const estadoColor = activo ? 'bg-blue-100 text-blue-800' : 'bg-gray-100 text-gray-800';

                vehiculoCard.innerHTML = `
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">Placa: ${vehiculo.placa}</h3>
                        <span class="px-3 py-1 rounded-full text-sm ${estadoColor}">
                            ${vehiculo.activo ? 'En Conjunto' : 'Retirado'}
                        </span>
                    </div>

                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <p class="text-sm text-gray-600">Visitante</p>
                            <p class="font-medium">${vehiculo.visitante}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Apartamento visitado</p>
                            <p class="font-medium">${vehiculo.apartamento}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Hora entrada</p>
                            <p class="font-medium">${vehiculo.horaEntrada}</p>
                        </div>
                        ${vehiculo.horaSalida ? `
                            <div>
                                <p class="text-sm text-gray-600">Hora salida</p>
                                <p class="font-medium">${vehiculo.horaSalida}</p>
                            </div>
                        ` : ''}
                    </div>

                    ${vehiculo.totalCobrado !== undefined ? `
                        <div class="border-t pt-4">
                            <p class="text-sm text-gray-600">Total cobrado:</p>
                            <p class="font-medium text-green-600">$${vehiculo.totalCobrado.toLocaleString()}</p>
                        </div>
                    ` : ''}

                    ${vehiculo.activo ? `
                        <div class="mt-4">
                            <button onclick="procesarSalidaVehiculo('${vehiculo.placa}')"
                                    class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors">
                                Procesar Salida
                            </button>
                        </div>
                    ` : ''}
                `;

                container.appendChild(vehiculoCard);
            });
        }

        // Función para procesar salida de vehículo
        async function procesarSalidaVehiculo(placa) {
            try {
                const response = await fetch('/api/vehiculos-visitantes/salida', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    },
                    body: JSON.stringify({ placa })
                });

                if (response.ok) {
                    const resultado = await response.json();
                    alert(`Salida procesada. Total cobrado: $${resultado.totalCobrado.toLocaleString()}`);
                    cargarVehiculos(); // Recargar la lista
                } else {
                    const error = await response.json();
                    alert('Error al procesar salida: ' + error.error);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error de conexión');
            }
        }

        // Funciones para el módulo de arriendos
        function cambiarTabArriendo(tab) {
            // Ocultar todos los contenidos
            document.querySelectorAll('.tab-content-arriendo').forEach(content => {
                content.classList.add('hidden');
            });

            // Remover clases activas de todos los tabs
            document.querySelectorAll('.tab-arriendo').forEach(tabBtn => {
                tabBtn.classList.remove('border-green-500', 'text-green-600');
                tabBtn.classList.add('border-transparent', 'text-gray-500');
            });

            // Mostrar contenido seleccionado
            document.getElementById(`arriendos-${tab}`).classList.remove('hidden');

            // Activar tab seleccionado
            const activeTab = document.getElementById(`tab-${tab === 'parqueaderos' ? 'parqueaderos-arriendo' : tab}`);
            if (activeTab) {
                activeTab.classList.add('border-green-500', 'text-green-600');
                activeTab.classList.remove('border-transparent', 'text-gray-500');
            }

            // Cargar contenido específico
            if (tab === 'apartamentos') {
                cargarArriendos();
            } else if (tab === 'parqueaderos') {
                cargarParqueaderosArriendo();
            }
        }

        async function cargarParqueaderosArriendo() {
            try {
                const response = await fetch('/api/parqueaderos-arriendo', {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    }
                });

                if (response.ok) {
                    const parqueaderos = await response.json();
                    mostrarParqueaderosArriendo(parqueaderos);
                } else {
                    console.error('Error al cargar parqueaderos en arriendo');
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        function mostrarParqueaderosArriendo(parqueaderos) {
            const container = document.getElementById('lista-parqueaderos-arriendo');
            if (!container) return;

            container.innerHTML = '';

            parqueaderos.forEach(parqueadero => {
                const parqueaderoCard = document.createElement('div');
                parqueaderoCard.className = 'bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow';

                const disponible = parqueadero.estado === 'disponible';
                const estadoColor = disponible ? 'bg-green-100 text-green-800' : 'bg-orange-100 text-orange-800';

                parqueaderoCard.innerHTML = `
                    <div class="text-center">
                        <h3 class="text-lg font-semibold text-gray-800 mb-2">P-${parqueadero.numero}</h3>
                        <span class="px-2 py-1 rounded-full text-xs ${estadoColor}">
                            ${parqueadero.estado === 'disponible' ? 'Disponible' : 'Arrendado'}
                        </span>

                        <div class="mt-3 space-y-1 text-sm text-gray-600">
                            <p><strong>Nivel:</strong> ${parqueadero.nivel}</p>
                            <p><strong>Precio:</strong> $${parqueadero.precio?.toLocaleString() || 'N/A'}</p>
                            ${parqueadero.apartamento ? `<p><strong>Arrendado a:</strong> ${parqueadero.apartamento}</p>` : ''}
                        </div>
                    </div>
                `;

                container.appendChild(parqueaderoCard);
            });
        }

        // Funciones para modales
        function abrirModalNuevoArriendo() {
            document.getElementById('modal-nuevo-arriendo').classList.remove('hidden');
            cargarOpcionesTorreNivel();
        }

        function cerrarModalNuevoArriendo() {
            document.getElementById('modal-nuevo-arriendo').classList.add('hidden');
            document.getElementById('form-nuevo-arriendo').reset();
        }

        function cargarOpcionesTorreNivel() {
            const tipoPropiedad = document.getElementById('tipo-propiedad').value;
            const torreNivelSelect = document.getElementById('torre-nivel');

            torreNivelSelect.innerHTML = '<option value="">Seleccionar...</option>';

            if (tipoPropiedad === 'apartamento') {
                torreNivelSelect.innerHTML += `
                    <option value="Torre 1">Torre 1</option>
                    <option value="Torre 2">Torre 2</option>
                    <option value="Torre 3">Torre 3</option>
                `;
            } else if (tipoPropiedad === 'parqueadero') {
                torreNivelSelect.innerHTML += `
                    <option value="Sótano 1">Sótano 1</option>
                    <option value="Sótano 2">Sótano 2</option>
                    <option value="Sótano 3">Sótano 3</option>
                `;
            }
        }

        // Funciones para sorteo de parqueaderos
        function abrirModalSorteoParqueaderos() {
            document.getElementById('modal-sorteo-parqueaderos').classList.remove('hidden');
        }

        function cerrarModalSorteoParqueaderos() {
            document.getElementById('modal-sorteo-parqueaderos').classList.add('hidden');
        }

        function generarParticipantesSorteo() {
            const numParticipantes = parseInt(document.getElementById('num-participantes').value);
            const resultadosDiv = document.getElementById('resultados-sorteo');

            let participantes = [];
            for (let i = 1; i <= numParticipantes; i++) {
                participantes.push(`Participante ${i} - Torre ${Math.ceil(Math.random() * 3)} Apto ${Math.floor(Math.random() * 20) + 1}${String.fromCharCode(65 + Math.floor(Math.random() * 4))}`);
            }

            resultadosDiv.innerHTML = `
                <h5 class="font-semibold text-gray-800 mb-3">Lista de Participantes (${numParticipantes})</h5>
                <div class="max-h-60 overflow-y-auto">
                    ${participantes.map((p, i) => `<p class="text-sm py-1">${i + 1}. ${p}</p>`).join('')}
                </div>
            `;
        }

        function realizarSorteoParqueaderos() {
            const numParticipantes = parseInt(document.getElementById('num-participantes').value);
            const nivelSorteo = document.getElementById('nivel-sorteo').value;

            // Generar parqueaderos disponibles según el nivel
            let parqueaderosDisponibles = [];
            if (nivelSorteo === 'Sótano 1') {
                for (let i = 1; i <= 33; i++) parqueaderosDisponibles.push(`P-${i.toString().padStart(3, '0')}`);
            } else if (nivelSorteo === 'Sótano 2') {
                for (let i = 34; i <= 66; i++) parqueaderosDisponibles.push(`P-${i.toString().padStart(3, '0')}`);
            } else if (nivelSorteo === 'Sótano 3') {
                for (let i = 67; i <= 100; i++) parqueaderosDisponibles.push(`P-${i.toString().padStart(3, '0')}`);
            } else {
                for (let i = 1; i <= 100; i++) parqueaderosDisponibles.push(`P-${i.toString().padStart(3, '0')}`);
            }

            // Mezclar arrays
            parqueaderosDisponibles = parqueaderosDisponibles.sort(() => Math.random() - 0.5);

            // Generar resultados
            let resultados = [];
            for (let i = 0; i < numParticipantes && i < parqueaderosDisponibles.length; i++) {
                resultados.push({
                    participante: `Participante ${i + 1}`,
                    parqueadero: parqueaderosDisponibles[i],
                    nivel: nivelSorteo === 'todos' ?
                        (i < 33 ? 'Sótano 1' : i < 66 ? 'Sótano 2' : 'Sótano 3') :
                        nivelSorteo
                });
            }

            const resultadosDiv = document.getElementById('resultados-sorteo');
            resultadosDiv.innerHTML = `
                <h5 class="font-semibold text-gray-800 mb-3">🎉 Resultados del Sorteo</h5>
                <div class="max-h-60 overflow-y-auto space-y-2">
                    ${resultados.map((r, i) => `
                        <div class="flex justify-between items-center p-2 bg-white rounded border">
                            <span class="font-medium">${r.participante}</span>
                            <span class="text-blue-600 font-bold">${r.parqueadero}</span>
                            <span class="text-sm text-gray-500">${r.nivel}</span>
                        </div>
                    `).join('')}
                </div>
            `;

            document.getElementById('btn-descargar-sorteo').disabled = false;
            window.resultadosSorteo = resultados;
        }

        function descargarResultadosSorteo() {
            if (!window.resultadosSorteo) return;

            const csv = 'Participante,Parqueadero,Nivel\n' +
                window.resultadosSorteo.map(r => `${r.participante},${r.parqueadero},${r.nivel}`).join('\n');

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `sorteo_parqueaderos_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
        }

        // Funciones para ingreso de vehículos
        function abrirModalIngreso() {
            document.getElementById('modal-ingreso-vehiculo').classList.remove('hidden');
            cargarApartamentosVisita();
            cargarUltimoRegistro();
            actualizarHistorialIngresos();
        }

        function cerrarModalIngresoVehiculo() {
            document.getElementById('modal-ingreso-vehiculo').classList.add('hidden');
            document.getElementById('form-ingreso-vehiculo').reset();
        }

        function cargarUltimoRegistro() {
            const ultimoRegistroDiv = document.getElementById('ultimo-registro-vehiculo');
            const ultimoRegistro = window.ultimoVehiculoRegistrado;

            if (ultimoRegistro) {
                ultimoRegistroDiv.innerHTML = `
                    <div class="flex items-center justify-between mb-2">
                        <h5 class="font-semibold text-green-800">✅ Registro Exitoso</h5>
                        <span class="text-xs text-green-600">${ultimoRegistro.fechaIngreso ? new Date(ultimoRegistro.fechaIngreso).toLocaleString('es-CO') : 'Hace un momento'}</span>
                    </div>
                    <div class="space-y-1 text-sm">
                        <p><strong>Placa:</strong> ${ultimoRegistro.placa}</p>
                        <p><strong>Visitante:</strong> ${ultimoRegistro.visitante}</p>
                        <p><strong>Visita a:</strong> ${ultimoRegistro.apartamento}</p>
                        <p><strong>Tipo:</strong> ${ultimoRegistro.tipo}</p>
                        <p><strong>Hora Entrada:</strong> ${ultimoRegistro.horaEntrada}</p>
                    </div>
                `;
            } else {
                ultimoRegistroDiv.innerHTML = '<p class="text-gray-500 text-center">No hay registros recientes</p>';
            }
        }

        async function actualizarHistorialIngresos() {
            try {
                const response = await fetch('/api/vehiculos-visitantes/hoy', {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    }
                });

                if (response.ok) {
                    const vehiculosHoy = await response.json();
                    mostrarHistorialIngresos(vehiculosHoy);
                } else {
                    console.error('Error al cargar historial');
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        function mostrarHistorialIngresos(vehiculos) {
            const historialDiv = document.getElementById('historial-ingresos-hoy');

            if (vehiculos.length === 0) {
                historialDiv.innerHTML = '<p class="text-gray-500 text-center">No hay ingresos registrados hoy</p>';
                return;
            }

            const vehiculosActivos = vehiculos.filter(v => v.activo);
            const vehiculosRetirados = vehiculos.filter(v => !v.activo);

            historialDiv.innerHTML = `
                <div class="space-y-3">
                    ${vehiculosActivos.length > 0 ? `
                        <div>
                            <h6 class="font-semibold text-blue-800 mb-2">🚗 En el Conjunto (${vehiculosActivos.length})</h6>
                            ${vehiculosActivos.map(v => `
                                <div class="bg-blue-50 border border-blue-200 rounded p-2 mb-2">
                                    <div class="flex justify-between items-center">
                                        <span class="font-medium">${v.placa}</span>
                                        <span class="text-xs text-blue-600">${v.horaEntrada}</span>
                                    </div>
                                    <div class="text-xs text-gray-600">
                                        ${v.visitante} → ${v.apartamento}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}

                    ${vehiculosRetirados.length > 0 ? `
                        <div>
                            <h6 class="font-semibold text-gray-600 mb-2">📝 Retirados Hoy (${vehiculosRetirados.length})</h6>
                            ${vehiculosRetirados.slice(0, 5).map(v => `
                                <div class="bg-gray-50 border border-gray-200 rounded p-2 mb-2">
                                    <div class="flex justify-between items-center">
                                        <span class="font-medium">${v.placa}</span>
                                        <span class="text-xs text-gray-500">${v.horaEntrada} - ${v.horaSalida || 'N/A'}</span>
                                    </div>
                                    <div class="text-xs text-gray-600">
                                        ${v.visitante} → ${v.apartamento}
                                        ${v.totalCobrado ? ` | $${v.totalCobrado.toLocaleString()}` : ''}
                                    </div>
                                </div>
                            `).join('')}
                            ${vehiculosRetirados.length > 5 ? `<p class="text-xs text-gray-500 text-center">... y ${vehiculosRetirados.length - 5} más</p>` : ''}
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function cargarApartamentosVisita() {
            const select = document.getElementById('apartamento-visita');
            select.innerHTML = '<option value="">Seleccionar apartamento...</option>';

            // Generar apartamentos dinámicamente
            for (let torre = 1; torre <= 3; torre++) {
                for (let piso = 1; piso <= 20; piso++) {
                    for (let apto of ['A', 'B', 'C', 'D']) {
                        if (Math.random() > 0.3) { // Simular algunos apartamentos ocupados
                            select.innerHTML += `<option value="Torre ${torre} - Apto ${piso}${apto}">Torre ${torre} - Apto ${piso}${apto}</option>`;
                        }
                    }
                }
            }
        }

        // Event listeners para formularios
        document.getElementById('tipo-propiedad').addEventListener('change', function() {
            cargarOpcionesTorreNivel();
            const camposApartamento = document.getElementById('campos-apartamento');
            if (this.value === 'apartamento') {
                camposApartamento.style.display = 'grid';
            } else {
                camposApartamento.style.display = 'none';
            }
        });

        document.getElementById('form-nuevo-arriendo').addEventListener('submit', async function(e) {
            e.preventDefault();

            const datos = {
                tipo: document.getElementById('tipo-propiedad').value,
                torre: document.getElementById('torre-nivel').value,
                numero: document.getElementById('numero-propiedad').value,
                precio: parseInt(document.getElementById('precio-arriendo').value),
                habitaciones: document.getElementById('habitaciones').value || null,
                banos: document.getElementById('banos').value || null,
                area: document.getElementById('area').value || null,
                descripcion: document.getElementById('descripcion-arriendo').value
            };

            try {
                const response = await fetch('/api/arriendos', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    },
                    body: JSON.stringify(datos)
                });

                if (response.ok) {
                    alert('Arriendo registrado exitosamente');
                    cerrarModalNuevoArriendo();
                    cargarArriendos();
                } else {
                    alert('Error al registrar arriendo');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error de conexión');
            }
        });

        document.getElementById('form-ingreso-vehiculo').addEventListener('submit', async function(e) {
            e.preventDefault();

            const datos = {
                placa: document.getElementById('placa-vehiculo').value,
                visitante: document.getElementById('nombre-visitante').value,
                apartamento: document.getElementById('apartamento-visita').value,
                tipo: document.getElementById('tipo-vehiculo').value
            };

            try {
                const response = await fetch('/api/vehiculos-visitantes/ingreso', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    },
                    body: JSON.stringify(datos)
                });

                if (response.ok) {
                    const resultado = await response.json();

                    // Guardar último registro para mostrar en el modal
                    window.ultimoVehiculoRegistrado = resultado.vehiculo;

                    // Actualizar visualización del último registro
                    cargarUltimoRegistro();

                    // Actualizar historial
                    actualizarHistorialIngresos();

                    // Actualizar la lista principal de vehículos
                    cargarVehiculos();

                    // Limpiar formulario
                    document.getElementById('form-ingreso-vehiculo').reset();

                    // Mostrar mensaje de éxito
                    alert(`✅ Ingreso registrado exitosamente\n\nPlaca: ${datos.placa}\nHora: ${resultado.horaEntrada}\nVisitante: ${datos.visitante}`);

                } else {
                    const error = await response.json();
                    alert('Error: ' + error.error);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error de conexión');
            }
        });

        // Funciones de formularios - Comentadas porque los formularios fueron reemplazados
        // document.getElementById('form-nueva-reserva').addEventListener('submit', function(e) {
        //     e.preventDefault();
        //     crearReserva();
        // });

        // Solo mantener los listeners que existen
        const formMensaje = document.getElementById('form-mensaje');
        if (formMensaje) {
            formMensaje.addEventListener('submit', function(e) {
                e.preventDefault();
                enviarMensaje();
            });
        }

        const formPqr = document.getElementById('form-nueva-pqr');
        if (formPqr) {
            formPqr.addEventListener('submit', function(e) {
                e.preventDefault();
                crearPQR();
            });
        }

        const formPermiso = document.getElementById('form-nuevo-permiso');
        if (formPermiso) {
            formPermiso.addEventListener('submit', function(e) {
                e.preventDefault();
                crearPermiso();
            });
        }

        // Implementación de funciones CRUD
        async function crearReserva() {
            const espacio = document.getElementById('nuevo-espacio').value;
            const fecha = document.getElementById('nueva-fecha').value;
            const hora = document.getElementById('nueva-hora').value;

            const nuevaReserva = {
                id: appData.reservas.length + 1,
                espacio,
                fecha,
                hora,
                usuario: 'Juan Pérez - Apto 401A'
            };

            appData.reservas.push(nuevaReserva);
            document.getElementById('modal-reserva').classList.add('hidden');
            cargarReservas();
            actualizarStats();
            mostrarNotificacion('Reserva creada exitosamente', 'success');

            // Limpiar formulario
            document.getElementById('form-nueva-reserva').reset();
        }

        async function eliminarReserva(id) {
            if (!confirm('¿Estás seguro de que deseas eliminar esta reserva?')) {
                return;
            }

            appData.reservas = appData.reservas.filter(r => r.id !== id);
            cargarReservas();
            actualizarStats();
            mostrarNotificacion('Reserva eliminada', 'success');
        }

        async function marcarComoPagado(id) {
            const pago = appData.pagos.find(p => p.id === id);
            if (pago) {
                pago.estado = 'pagado';
                cargarPagos();
                actualizarStats();
                mostrarNotificacion('Pago marcado como completado', 'success');
            }
        }

        async function enviarMensaje() {
            const mensaje = document.getElementById('nuevo-mensaje').value.trim();
            if (!mensaje) return;

            const nuevoMensaje = {
                id: appData.mensajes.length + 1,
                usuario: 'Juan Pérez - 401A',
                mensaje,
                fecha: new Date().toLocaleString('es-CO'),
                tipo: tipoChat
            };

            appData.mensajes.push(nuevoMensaje);
            document.getElementById('nuevo-mensaje').value = '';
            cargarChat();
            mostrarNotificacion('Mensaje enviado', 'success');
        }

        async function crearPQR() {
            const tipo = document.getElementById('nuevo-tipo-pqr').value;
            const asunto = document.getElementById('nuevo-asunto-pqr').value;
            const descripcion = document.getElementById('nueva-descripcion-pqr').value;

            const nuevaPQR = {
                id: appData.pqrs.length + 1,
                tipo,
                asunto,
                descripcion,
                estado: 'Pendiente',
                fecha: new Date().toLocaleDateString('es-CO')
            };

            appData.pqrs.push(nuevaPQR);
            document.getElementById('modal-pqr').classList.add('hidden');
            cargarPQR();
            actualizarStats();
            mostrarNotificacion('PQR creada exitosamente', 'success');

            // Limpiar formulario
            document.getElementById('form-nueva-pqr').reset();
        }

        function togglePermisoFields() {
            const tipo = document.getElementById('permiso-tipo').value;
            const camposPersona = document.getElementById('campos-persona');
            const camposObjeto = document.getElementById('campos-objeto');

            camposPersona.classList.add('hidden');
            camposObjeto.classList.add('hidden');

            if (tipo === 'Entrada Personal' || tipo === 'Entrada Visitante' || tipo === 'Trabajo Apartamento') {
                camposPersona.classList.remove('hidden');
            } else if (tipo === 'Salida Objeto') {
                camposObjeto.classList.remove('hidden');
            }
        }

        async function crearPermiso() {
            const tipo = document.getElementById('permiso-tipo').value;
            const nombre = document.getElementById('permiso-nombre').value;
            const cedula = document.getElementById('permiso-cedula').value;
            const objeto = document.getElementById('permiso-objeto').value;
            const vigencia = document.getElementById('permiso-vigencia').value;

            const nuevoPermiso = {
                id: appData.permisos.length + 1,
                tipo,
                nombre,
                cedula,
                objeto,
                autorizado: 'Juan Pérez - 401A',
                fecha: new Date().toLocaleDateString('es-CO'),
                vigencia
            };

            appData.permisos.push(nuevoPermiso);
            document.getElementById('modal-permiso').classList.add('hidden');
            cargarPermisos();
            mostrarNotificacion('Permiso creado exitosamente', 'success');

            // Limpiar formulario
            document.getElementById('form-nuevo-permiso').reset();

            // Simular delay para mostrar proceso
            setTimeout(() => {
                mostrarNotificacion('Permiso creado exitosamente', 'success');
            }, 1000);
        }

        async function eliminarPermiso(id) {
            if (!confirm('¿Estás seguro de que deseas eliminar este permiso?')) {
                return;
            }

            appData.permisos = appData.permisos.filter(p => p.id !== id);
            cargarPermisos();
            actualizarStats();
            mostrarNotificacion('Permiso eliminado', 'success');
        }

        // Inicializar aplicación
        document.addEventListener('DOMContentLoaded', function() {
            // Configurar fecha mínima para reservas (hoy)
            const hoy = new Date().toISOString().split('T')[0];
            const nuevaFecha = document.getElementById('nueva-fecha');
            if (nuevaFecha) {
                nuevaFecha.setAttribute('min', hoy);
            }

            // Configurar fecha mínima para permisos (hoy)
            const permisoVigencia = document.getElementById('permiso-vigencia');
            if (permisoVigencia) {
                permisoVigencia.setAttribute('min', hoy);
            }

            // Inicializar chat
            seleccionarTipoChat('general');

            // Mostrar dashboard por defecto
            mostrarSeccion('dashboard');

            // Actualizar reloj cada minuto
            actualizarReloj();
            setInterval(actualizarReloj, 60000);

            // Mostrar badge de notificaciones en chat
            document.getElementById('chat-badge').classList.remove('hidden');

            // Mensaje de bienvenida
            setTimeout(() => {
                mostrarNotificacion('¡Bienvenido a la nueva experiencia de Aralia de Castilla!', 'info');
            }, 1000);
        });

        // Sistema de Autenticación
        let currentUser = null;
        let usuarioActual = null; // Alias para compatibilidad

        function switchTab(tab) {
            const loginTab = document.getElementById('login-tab');
            const registerTab = document.getElementById('register-tab');
            const loginForm = document.getElementById('login-form');
            const registerForm = document.getElementById('register-form');

            if (tab === 'login') {
                loginTab.className = "flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors bg-white text-blue-600 shadow-sm";
                registerTab.className = "flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors text-gray-600 hover:text-gray-800";
                loginForm.classList.remove('hidden');
                registerForm.classList.add('hidden');
            } else {
                registerTab.className = "flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors bg-white text-green-600 shadow-sm";
                loginTab.className = "flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors text-gray-600 hover:text-gray-800";
                registerForm.classList.remove('hidden');
                loginForm.classList.add('hidden');
            }
        }

        function showMessage(message, type) {
            const messageDiv = document.getElementById('auth-message');
            const messageText = document.getElementById('auth-message-text');

            messageText.textContent = message;
            messageDiv.className = `mt-4 p-3 rounded-lg ${type === 'error' ? 'bg-red-100 text-red-700 border border-red-300' : 'bg-green-100 text-green-700 border border-green-300'}`;
            messageDiv.classList.remove('hidden');

            setTimeout(() => {
                messageDiv.classList.add('hidden');
            }, 5000);
        }

        async function login(email, password) {
            try {
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();

                if (data.success) {
                    localStorage.setItem('authToken', data.token);
                    localStorage.setItem('user', JSON.stringify(data.usuario));
                    currentUser = data.usuario;
                    usuarioActual = data.usuario;

                    document.getElementById('login-screen').classList.add('hidden');
                    document.getElementById('main-app').classList.remove('hidden');

                    // Actualizar información del usuario en el header
                    updateUserInfo();

                    // Inicializar funcionalidades que requieren autenticación
                    inicializarNoticias();

                    showMessage('¡Bienvenido!', 'success');
                } else {
                    showMessage(data.mensaje || 'Error al iniciar sesión', 'error');
                }
            } catch (error) {
                showMessage('Error de conexión', 'error');
            }
        }

        async function register(nombre, email, apartamento, password) {
            try {
                const response = await fetch('/api/auth/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ nombre, email, apartamento, password })
                });

                const data = await response.json();

                if (data.success) {
                    showMessage('Usuario registrado exitosamente. Ahora puedes iniciar sesión.', 'success');
                    switchTab('login');
                } else {
                    showMessage(data.mensaje || 'Error al registrar usuario', 'error');
                }
            } catch (error) {
                showMessage('Error de conexión', 'error');
            }
        }

        function updateUserInfo() {
            if (currentUser) {
                const userInfoElement = document.querySelector('.text-blue-100');
                if (userInfoElement) {
                    userInfoElement.innerHTML = `
                        <i class="fas fa-user-circle mr-2"></i>
                        Bienvenido, ${currentUser.nombre} - ${currentUser.apartamento}
                    `;
                }
            }
        }

        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            currentUser = null;

            document.getElementById('main-app').classList.add('hidden');
            document.getElementById('login-screen').classList.remove('hidden');
        }

        // Event listeners para los formularios
        document.getElementById('login-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            login(email, password);
        });

        document.getElementById('register-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const nombre = document.getElementById('register-nombre').value;
            const email = document.getElementById('register-email').value;
            const apartamento = document.getElementById('register-apartamento').value;
            const password = document.getElementById('register-password').value;
            register(nombre, email, apartamento, password);
        });

        // Verificar autenticación al cargar la página
        document.addEventListener('DOMContentLoaded', function() {
            const token = localStorage.getItem('token');
            const user = localStorage.getItem('user');

            if (token && user) {
                currentUser = JSON.parse(user);
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('main-app').classList.remove('hidden');
                updateUserInfo();
            }
        });

        // Funciones auxiliares
        function actualizarReloj() {
            const ahora = new Date();
            const timeString = ahora.toLocaleTimeString('es-CO', {
                hour: '2-digit',
                minute: '2-digit'
            });
            const elemento = document.getElementById('current-time');
            if (elemento) {
                elemento.textContent = timeString;
            }
        }

        function actualizarStats() {
            // Actualizar contadores en el dashboard
            if (document.getElementById('dashboard-section') && !document.getElementById('dashboard-section').classList.contains('hidden')) {
                cargarDashboard();
            }
        }

        function mostrarNotificacion(mensaje, tipo = 'info') {
            const container = document.getElementById('notification-container');
            const notificacion = document.createElement('div');

            const iconos = {
                success: 'fa-check-circle',
                error: 'fa-times-circle',
                warning: 'fa-exclamation-triangle',
                info: 'fa-info-circle'
            };

            notificacion.className = `notification ${tipo}`;
            notificacion.innerHTML = `
                <div class="flex items-center">
                    <i class="fas ${iconos[tipo]} mr-3"></i>
                    <span>${mensaje}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;

            container.appendChild(notificacion);

            // Auto-remover después de 5 segundos
            setTimeout(() => {
                if (notificacion.parentElement) {
                    notificacion.remove();
                }
            }, 5000);
        }

        // Variables para el calendario de reservas
        let fechaSeleccionada = new Date();
        let espacioSeleccionado = null;
        let vistaCalendario = 'semana'; // 'semana' o 'mes'
        let horaSeleccionada = null;

        // Espacios disponibles con información detallada
        const espaciosDisponibles = [
            {
                id: 'salon-social',
                nombre: 'Salón Social',
                icono: 'fas fa-users',
                capacidad: '50 personas',
                descripcion: 'Perfecto para celebraciones y reuniones familiares'
            },
            {
                id: 'piscina',
                nombre: 'Piscina',
                icono: 'fas fa-swimmer',
                capacidad: '30 personas',
                descripcion: 'Área recreativa con zona húmeda'
            },
            {
                id: 'cancha-futbol',
                nombre: 'Cancha de Fútbol',
                icono: 'fas fa-futbol',
                capacidad: '22 jugadores',
                descripcion: 'Cancha sintética para deportes'
            },
            {
                id: 'bbq',
                nombre: 'Zona BBQ',
                icono: 'fas fa-fire',
                capacidad: '20 personas',
                descripcion: 'Asadores y mesas para parrilladas'
            },
            {
                id: 'salon-ninos',
                nombre: 'Salón de Niños',
                icono: 'fas fa-child',
                capacidad: '25 niños',
                descripcion: 'Espacio recreativo infantil'
            },
            {
                id: 'gym',
                nombre: 'Gimnasio',
                icono: 'fas fa-dumbbell',
                capacidad: '15 personas',
                descripcion: 'Equipos de ejercicio y yoga'
            }
        ];

        // Horarios disponibles
        const horariosDisponibles = [
            '08:00', '09:00', '10:00', '11:00', '12:00', '13:00',
            '14:00', '15:00', '16:00', '17:00', '18:00', '19:00', '20:00'
        ];

        // Reservas existentes (simuladas) - Fechas actuales de septiembre 2025
        let reservasExistentes = [
            {
                fecha: '2025-09-16',
                hora: '10:00',
                espacio: 'salon-social',
                usuario: 'María González - Apto 301'
            },
            {
                fecha: '2025-09-16',
                hora: '15:00',
                espacio: 'piscina',
                usuario: 'Carlos Ruiz - Apto 205'
            },
            {
                fecha: '2025-09-17',
                hora: '18:00',
                espacio: 'gym',
                usuario: 'Ana Martínez - Apto 102'
            },
            {
                fecha: '2025-09-17',
                hora: '09:00',
                espacio: 'cancha-futbol',
                usuario: 'Luis García - Apto 404'
            },
            {
                fecha: '2025-09-18',
                hora: '19:00',
                espacio: 'bbq',
                usuario: 'Patricia Soto - Apto 303'
            },
            {
                fecha: '2025-09-19',
                hora: '11:00',
                espacio: 'salon-ninos',
                usuario: 'Laura Vega - Apto 205'
            }
        ];

        function abrirModalReservas() {
            document.getElementById('reservas-modal').classList.remove('hidden');
            cargarEspaciosDisponibles();
            espacioSeleccionado = null;
            horaSeleccionada = null;
            // Mostrar paso 1 por defecto
            document.getElementById('paso-1').classList.remove('hidden');
            document.getElementById('paso-2').classList.add('hidden');
            actualizarProgreso(1);
        }

        function cerrarModalReservas() {
            document.getElementById('reservas-modal').classList.add('hidden');
        }

        function cargarEspaciosDisponibles() {
            const container = document.getElementById('espacios-grid');
            container.innerHTML = '';

            espaciosDisponibles.forEach(espacio => {
                const espacioCard = document.createElement('div');
                espacioCard.className = 'espacio-card';
                espacioCard.onclick = () => seleccionarEspacioModal(espacio.id);

                espacioCard.innerHTML = `
                    <div class="text-center">
                        <div class="text-3xl text-blue-600 mb-3">
                            <i class="${espacio.icono}"></i>
                        </div>
                        <h3 class="font-semibold text-gray-800 mb-2">${espacio.nombre}</h3>
                        <p class="text-sm text-gray-600 mb-1">${espacio.capacidad}</p>
                        <p class="text-xs text-gray-500">${espacio.descripcion}</p>
                    </div>
                `;

                container.appendChild(espacioCard);
            });
        }

        function seleccionarEspacio(espacioId) {
            // Remover selección anterior
            document.querySelectorAll('.space-selector').forEach(selector => {
                selector.classList.remove('selected');
                selector.style.backgroundColor = '';
                selector.style.borderColor = '';
            });

            // Seleccionar nuevo espacio
            const selectedElement = event.currentTarget;
            selectedElement.classList.add('selected');
            selectedElement.style.backgroundColor = '#dbeafe';
            selectedElement.style.borderColor = '#3b82f6';
            espacioSeleccionado = espacioId;

            // Mostrar el modal de reserva
            mostrarModalReserva(espacioId);
        }

        function seleccionarEspacioModal(espacioId) {
            // Remover selección anterior
            document.querySelectorAll('.espacio-card').forEach(card => {
                card.classList.remove('selected');
            });

            // Seleccionar nuevo espacio
            event.currentTarget.classList.add('selected');
            espacioSeleccionado = espacioId;

            // Habilitar botón siguiente
            document.getElementById('btn-siguiente').disabled = false;
        }

        function siguientePaso() {
            if (!espacioSeleccionado) return;

            document.getElementById('paso-1').classList.add('hidden');
            document.getElementById('paso-2').classList.remove('hidden');
            actualizarProgreso(2);

            // Cargar calendario
            cargarCalendarioReservas();
            cargarMiniCalendario();
        }

        function pasoAnterior() {
            document.getElementById('paso-2').classList.add('hidden');
            document.getElementById('paso-1').classList.remove('hidden');
            actualizarProgreso(1);
        }

        function actualizarProgreso(paso) {
            // Actualizar indicadores de progreso
            document.querySelectorAll('.step-indicator').forEach((indicator, index) => {
                if (index + 1 <= paso) {
                    indicator.classList.add('active');
                } else {
                    indicator.classList.remove('active');
                }
            });
        }

        function cargarCalendarioReservas() {
            if (vistaCalendario === 'semana') {
                cargarVistaSemanaal();
            } else {
                cargarVistaMensual();
            }
        }

        function cargarVistaMensual() {
            const calendarioContainer = document.getElementById('calendario-mes');
            const fecha = new Date(fechaSeleccionada);
            const primerDia = new Date(fecha.getFullYear(), fecha.getMonth(), 1);
            const ultimoDia = new Date(fecha.getFullYear(), fecha.getMonth() + 1, 0);

            let calendarioHTML = `
                <div class="grid grid-cols-7 border-b border-gray-200">
                    <div class="p-3 text-center font-medium text-gray-600">Dom</div>
                    <div class="p-3 text-center font-medium text-gray-600">Lun</div>
                    <div class="p-3 text-center font-medium text-gray-600">Mar</div>
                    <div class="p-3 text-center font-medium text-gray-600">Mié</div>
                    <div class="p-3 text-center font-medium text-gray-600">Jue</div>
                    <div class="p-3 text-center font-medium text-gray-600">Vie</div>
                    <div class="p-3 text-center font-medium text-gray-600">Sáb</div>
                </div>
            `;

            // Crear filas de semanas
            let fechaActual = new Date(primerDia);
            fechaActual.setDate(primerDia.getDate() - primerDia.getDay()); // Ir al domingo anterior

            while (fechaActual <= ultimoDia || fechaActual.getDay() !== 0) {
                calendarioHTML += '<div class="grid grid-cols-7">';

                for (let dia = 0; dia < 7; dia++) {
                    const fechaStr = fechaActual.toISOString().split('T')[0];
                    const esMesActual = fechaActual.getMonth() === fecha.getMonth();
                    const esHoy = fechaActual.toDateString() === new Date().toDateString();

                    // Verificar si hay reservas este día
                    const tieneReservas = reservasExistentes.some(reserva =>
                        reserva.fecha === fechaStr && reserva.espacio === espacioSeleccionado
                    );

                    let clasesDia = 'calendar-day p-3 border border-gray-200 min-h-[80px] cursor-pointer';
                    if (!esMesActual) clasesDia += ' text-gray-400 bg-gray-50';
                    if (esHoy) clasesDia += ' today';
                    if (tieneReservas) clasesDia += ' has-reservation';

                    calendarioHTML += `
                        <div class="${clasesDia}" onclick="seleccionarDiaMensual('${fechaStr}')">
                            <div class="font-medium">${fechaActual.getDate()}</div>
                            ${tieneReservas ? '<div class="text-xs text-orange-600 mt-1">Reservado</div>' : ''}
                        </div>
                    `;

                    fechaActual.setDate(fechaActual.getDate() + 1);
                }

                calendarioHTML += '</div>';

                if (fechaActual.getDay() === 0 && fechaActual > ultimoDia) break;
            }

            calendarioContainer.innerHTML = calendarioHTML;
        }

        function seleccionarDiaMensual(fechaStr) {
            fechaSeleccionada = new Date(fechaStr);
            // Cambiar a vista semanal para seleccionar hora específica
            cambiarVistaCalendario('semana');
            cargarCalendarioReservas();
            cargarMiniCalendario();
        }

        function cargarVistaSemanaal() {
            const calendarioContainer = document.getElementById('calendario-semana');
            const inicioSemana = new Date(fechaSeleccionada);
            inicioSemana.setDate(fechaSeleccionada.getDate() - fechaSeleccionada.getDay());

            let calendarioHTML = `
                <div class="grid grid-cols-8 border-b border-gray-200">
                    <div class="p-3 text-center font-medium text-gray-600 border-r border-gray-200">Hora</div>
            `;

            // Generar headers de días
            const dias = ['Dom', 'Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb'];
            for (let i = 0; i < 7; i++) {
                const dia = new Date(inicioSemana);
                dia.setDate(inicioSemana.getDate() + i);
                calendarioHTML += `
                    <div class="p-3 text-center border-r border-gray-200">
                        <div class="font-medium text-gray-800">${dias[i]}</div>
                        <div class="text-sm text-gray-600">${dia.getDate()}</div>
                    </div>
                `;
            }
            calendarioHTML += '</div>';

            // Generar filas de horarios
            horariosDisponibles.forEach(hora => {
                calendarioHTML += `<div class="grid grid-cols-8 border-b border-gray-100">`;
                calendarioHTML += `<div class="p-3 text-center text-sm font-medium text-gray-600 border-r border-gray-200">${hora}</div>`;

                for (let i = 0; i < 7; i++) {
                    const dia = new Date(inicioSemana);
                    dia.setDate(inicioSemana.getDate() + i);
                    const fechaStr = dia.toISOString().split('T')[0];

                    const estaReservado = reservasExistentes.some(reserva =>
                        reserva.fecha === fechaStr &&
                        reserva.hora === hora &&
                        reserva.espacio === espacioSeleccionado
                    );

                    const claseSlot = estaReservado ? 'time-slot reserved' : 'time-slot available';
                    const textoSlot = estaReservado ? 'Ocupado' : 'Disponible';
                    calendarioHTML += `
                        <div class="${claseSlot}"
                             onclick="${estaReservado ? '' : `seleccionarHorario('${fechaStr}', '${hora}')`}"
                             data-fecha="${fechaStr}"
                             data-hora="${hora}"
                             title="${estaReservado ? 'Este horario ya está reservado' : 'Click para seleccionar'}">
                            ${textoSlot}
                        </div>
                    `;
                }
                calendarioHTML += '</div>';
            });

            calendarioContainer.innerHTML = calendarioHTML;
        }

        function cargarMiniCalendario() {
            const miniCalendario = document.getElementById('mini-calendario');
            if (!miniCalendario) {
                console.error('No se encontró el elemento mini-calendario');
                return;
            }

            const fecha = new Date(fechaSeleccionada);
            const primerDia = new Date(fecha.getFullYear(), fecha.getMonth(), 1);
            const ultimoDia = new Date(fecha.getFullYear(), fecha.getMonth() + 1, 0);

            const meses = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
                          'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];

            let calendarioHTML = `
                <div class="flex items-center justify-between mb-4">
                    <button onclick="cambiarMesModal(-1)" class="p-1 hover:bg-gray-200 rounded text-gray-600">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <h3 class="font-semibold text-gray-800">
                        ${meses[fecha.getMonth()]} ${fecha.getFullYear()}
                    </h3>
                    <button onclick="cambiarMesModal(1)" class="p-1 hover:bg-gray-200 rounded text-gray-600">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                <div class="grid grid-cols-7 gap-1 text-center text-xs mb-2">
                    <div class="p-1 font-medium text-gray-600">D</div>
                    <div class="p-1 font-medium text-gray-600">L</div>
                    <div class="p-1 font-medium text-gray-600">M</div>
                    <div class="p-1 font-medium text-gray-600">M</div>
                    <div class="p-1 font-medium text-gray-600">J</div>
                    <div class="p-1 font-medium text-gray-600">V</div>
                    <div class="p-1 font-medium text-gray-600">S</div>
                </div>
                <div class="grid grid-cols-7 gap-1">
            `;

            // Espacios en blanco para días anteriores al primer día del mes
            for (let i = 0; i < primerDia.getDay(); i++) {
                calendarioHTML += '<div></div>';
            }

            // Días del mes
            for (let dia = 1; dia <= ultimoDia.getDate(); dia++) {
                const fechaDia = new Date(fecha.getFullYear(), fecha.getMonth(), dia);
                const fechaStr = fechaDia.toISOString().split('T')[0];
                const esHoy = fechaDia.toDateString() === new Date().toDateString();
                const esSeleccionada = fechaDia.toDateString() === fechaSeleccionada.toDateString();

                let clasesDia = 'mini-calendar-day p-2 text-center text-sm cursor-pointer hover:bg-blue-50 rounded';
                if (esHoy) clasesDia += ' today';
                if (esSeleccionada) clasesDia += ' selected';

                calendarioHTML += `
                    <div class="${clasesDia}" onclick="seleccionarFechaMini('${fechaStr}')">
                        ${dia}
                    </div>
                `;
            }

            calendarioHTML += '</div>';
            miniCalendario.innerHTML = calendarioHTML;
        }

        function seleccionarFechaMini(fechaStr) {
            fechaSeleccionada = new Date(fechaStr);
            cargarMiniCalendario();
            cargarCalendarioReservas();
        }

        function cambiarMesModal(direccion) {
            fechaSeleccionada.setMonth(fechaSeleccionada.getMonth() + direccion);
            cargarMiniCalendario();
            cargarCalendarioReservas();
        }

        function cambiarVistaCalendario(vista) {
            vistaCalendario = vista;

            // Actualizar botones
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Mostrar/ocultar vistas
            if (vista === 'semana') {
                document.getElementById('calendario-semana').classList.remove('hidden');
                document.getElementById('calendario-mes').classList.add('hidden');
            } else {
                document.getElementById('calendario-semana').classList.add('hidden');
                document.getElementById('calendario-mes').classList.remove('hidden');
            }

            cargarCalendarioReservas();
        }

        function seleccionarHorario(fecha, hora) {
            // Verificar si el slot está disponible
            const slot = document.querySelector(`[data-fecha="${fecha}"][data-hora="${hora}"]`);
            if (slot.classList.contains('reserved')) {
                mostrarNotificacion('Este horario ya está reservado', 'warning');
                return;
            }

            // Remover selección anterior
            document.querySelectorAll('.time-slot').forEach(s => {
                s.classList.remove('selected');
            });

            // Seleccionar nuevo horario
            slot.classList.add('selected');
            fechaSeleccionada = new Date(fecha);
            horaSeleccionada = hora;

            // Habilitar botón de confirmar
            document.getElementById('btn-confirmar-reserva').disabled = false;

            // Actualizar información de la reserva
            actualizarResumenReserva();
        }

        function actualizarResumenReserva() {
            if (espacioSeleccionado && fechaSeleccionada && horaSeleccionada) {
                const espacio = espaciosDisponibles.find(e => e.id === espacioSeleccionado);
                const resumen = document.getElementById('resumen-reserva');

                resumen.innerHTML = `
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <h4 class="font-semibold text-blue-800 mb-2">Resumen de tu reserva:</h4>
                        <div class="space-y-1 text-sm">
                            <div><strong>Espacio:</strong> ${espacio.nombre}</div>
                            <div><strong>Fecha:</strong> ${fechaSeleccionada.toLocaleDateString('es-ES')}</div>
                            <div><strong>Hora:</strong> ${horaSeleccionada}</div>
                            <div><strong>Usuario:</strong> ${currentUser.nombre}</div>
                        </div>
                    </div>
                `;
                resumen.classList.remove('hidden');
            }
        }

        async function confirmarReserva() {
            if (!espacioSeleccionado || !fechaSeleccionada || !horaSeleccionada || !currentUser) {
                mostrarNotificacion('Faltan datos para completar la reserva', 'error');
                return;
            }

            const espacio = espaciosDisponibles.find(e => e.id === espacioSeleccionado);
            const nuevaReserva = {
                espacio: espacio.nombre,
                fecha: fechaSeleccionada.toISOString().split('T')[0],
                hora: horaSeleccionada,
                usuario: `${currentUser.nombre} - ${currentUser.apartamento}`
            };

            try {
                // Guardar en el servidor
                const response = await fetch('/api/reservas', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: JSON.stringify(nuevaReserva)
                });

                if (response.ok) {
                    // Agregar a la lista local también
                    reservasExistentes.push({
                        fecha: nuevaReserva.fecha,
                        hora: nuevaReserva.hora,
                        espacio: espacioSeleccionado,
                        usuario: nuevaReserva.usuario
                    });

                    // Agregar a los datos de la app
                    if (!appData.reservas) appData.reservas = [];
                    appData.reservas.push({
                        id: Date.now(),
                        espacio: nuevaReserva.espacio,
                        fecha: nuevaReserva.fecha,
                        hora: nuevaReserva.hora,
                        usuario: nuevaReserva.usuario
                    });

                    mostrarNotificacion('¡Reserva confirmada exitosamente!', 'success');
                    cerrarModalReservas();

                    // Actualizar la lista de reservas si estamos en esa sección
                    if (document.getElementById('reservas-section') && !document.getElementById('reservas-section').classList.contains('hidden')) {
                        cargarReservas();
                    }
                } else {
                    mostrarNotificacion('Error al guardar la reserva', 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                mostrarNotificacion('Error de conexión', 'error');
            }
        }

        // ============= FUNCIONES CHAT PRIVADO =============

        let usuarios = [];
        let solicitudesChat = [];
        let destinatarioSeleccionado = null;

        async function abrirChatPrivado() {
            try {
                await cargarUsuarios();
                await cargarSolicitudes();
                cargarApartamentosPorTorre();
                document.getElementById('modal-chat-privado').classList.remove('hidden');
            } catch (error) {
                console.error('Error al abrir chat privado:', error);
                mostrarNotificacion('Error al cargar información de usuarios', 'error');
            }
        }

        function cerrarChatPrivado() {
            document.getElementById('modal-chat-privado').classList.add('hidden');
        }

        async function cargarUsuarios() {
            try {
                const response = await fetch('/api/usuarios', {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    }
                });

                if (response.ok) {
                    usuarios = await response.json();
                    console.log('Usuarios cargados:', usuarios);
                } else {
                    throw new Error('Error al cargar usuarios');
                }
            } catch (error) {
                console.error('Error:', error);
                throw error;
            }
        }

        async function cargarSolicitudes() {
            try {
                const response = await fetch('/api/chat/solicitudes', {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    }
                });

                if (response.ok) {
                    solicitudesChat = await response.json();
                    actualizarListaSolicitudes();
                } else {
                    throw new Error('Error al cargar solicitudes');
                }
            } catch (error) {
                console.error('Error:', error);
                solicitudesChat = [];
                actualizarListaSolicitudes();
            }
        }

        function cargarApartamentosPorTorre() {
            // Organizar usuarios por torre
            const usuariosPorTorre = {
                1: [],
                2: [],
                3: []
            };

            usuarios.forEach(usuario => {
                // Excluir al usuario actual si está autenticado
                const currentUserId = usuarioActual?.id || currentUser?.id;
                if (!currentUserId || usuario.id !== currentUserId) {
                    const match = usuario.apartamento.match(/Torre (\d+)/);
                    if (match) {
                        const torre = parseInt(match[1]);
                        if (usuariosPorTorre[torre]) {
                            usuariosPorTorre[torre].push(usuario);
                        }
                    }
                }
            });

            // Renderizar apartamentos en cada torre
            for (let torre = 1; torre <= 3; torre++) {
                const container = document.getElementById(`apartamentos-torre-${torre}`);
                let html = '';

                if (usuariosPorTorre[torre].length === 0) {
                    html = '<p class="text-gray-500 text-sm text-center">No hay residentes disponibles</p>';
                } else {
                    usuariosPorTorre[torre].forEach(usuario => {
                        html += `
                            <button onclick="seleccionarResidente(${usuario.id})"
                                    class="w-full text-left p-3 bg-gray-50 hover:bg-blue-50 rounded-lg transition-colors border border-gray-200 hover:border-blue-300">
                                <div class="font-medium text-gray-800">${usuario.nombre}</div>
                                <div class="text-sm text-gray-600">${usuario.apartamento}</div>
                            </button>
                        `;
                    });
                }

                container.innerHTML = html;
            }
        }

        function seleccionarResidente(usuarioId) {
            const usuario = usuarios.find(u => u.id === usuarioId);
            if (usuario) {
                destinatarioSeleccionado = usuario;
                document.getElementById('destinatario-info').textContent =
                    `${usuario.nombre} - ${usuario.apartamento}`;

                // Cerrar modal chat privado y abrir modal solicitud
                document.getElementById('modal-chat-privado').classList.add('hidden');
                document.getElementById('modal-solicitar-chat').classList.remove('hidden');

                // Focus en el textarea
                document.getElementById('mensaje-solicitud').focus();
            }
        }

        function cerrarModalSolicitud() {
            document.getElementById('modal-solicitar-chat').classList.add('hidden');
            document.getElementById('modal-chat-privado').classList.remove('hidden');

            // Limpiar campos
            document.getElementById('mensaje-solicitud').value = '';
            destinatarioSeleccionado = null;
        }

        async function enviarSolicitudChat(event) {
            event.preventDefault();

            if (!destinatarioSeleccionado) {
                mostrarNotificacion('No hay destinatario seleccionado', 'error');
                return;
            }

            const mensaje = document.getElementById('mensaje-solicitud').value.trim();
            if (!mensaje) {
                mostrarNotificacion('Escribe un mensaje', 'error');
                return;
            }

            try {
                const response = await fetch('/api/chat/solicitar', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    },
                    body: JSON.stringify({
                        destinatarioId: destinatarioSeleccionado.id,
                        mensaje: mensaje
                    })
                });

                const data = await response.json();

                if (data.success) {
                    mostrarNotificacion('Solicitud enviada exitosamente', 'success');
                    document.getElementById('modal-solicitar-chat').classList.add('hidden');
                    document.getElementById('mensaje-solicitud').value = '';
                    destinatarioSeleccionado = null;
                } else {
                    mostrarNotificacion(data.mensaje || 'Error al enviar solicitud', 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                mostrarNotificacion('Error de conexión', 'error');
            }
        }

        function actualizarListaSolicitudes() {
            const container = document.getElementById('lista-solicitudes');
            const countElement = document.getElementById('solicitudes-count');

            countElement.textContent = solicitudesChat.length;

            if (solicitudesChat.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-sm text-center">No hay solicitudes pendientes</p>';
                return;
            }

            let html = '';
            solicitudesChat.forEach(solicitud => {
                html += `
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3">
                        <div class="flex items-start justify-between mb-2">
                            <div class="flex-1">
                                <div class="font-medium text-gray-800">${solicitud.remitente}</div>
                                <div class="text-sm text-gray-600">${solicitud.remitenteApto}</div>
                            </div>
                            <div class="text-xs text-gray-500">${new Date(solicitud.fecha).toLocaleDateString()}</div>
                        </div>
                        <div class="text-sm text-gray-700 mb-3">${solicitud.mensaje}</div>
                        <div class="flex space-x-2">
                            <button onclick="responderSolicitud(${solicitud.id}, 'aceptada')"
                                    class="flex-1 bg-green-600 hover:bg-green-700 text-white text-xs py-1 px-2 rounded transition-colors">
                                Aceptar
                            </button>
                            <button onclick="responderSolicitud(${solicitud.id}, 'rechazada')"
                                    class="flex-1 bg-red-600 hover:bg-red-700 text-white text-xs py-1 px-2 rounded transition-colors">
                                Rechazar
                            </button>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        async function responderSolicitud(solicitudId, respuesta) {
            try {
                const response = await fetch('/api/chat/responder', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    },
                    body: JSON.stringify({
                        solicitudId: solicitudId,
                        respuesta: respuesta
                    })
                });

                const data = await response.json();

                if (data.success) {
                    const accion = respuesta === 'aceptada' ? 'aceptada' : 'rechazada';
                    mostrarNotificacion(`Solicitud ${accion} exitosamente`, 'success');

                    // Recargar solicitudes
                    await cargarSolicitudes();

                    if (respuesta === 'aceptada') {
                        mostrarNotificacion('Chat privado iniciado. Puedes encontrarlo en la sección de chats activos.', 'info');
                    }
                } else {
                    mostrarNotificacion(data.mensaje || 'Error al responder solicitud', 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                mostrarNotificacion('Error de conexión', 'error');
            }
        }

        // Event listener para el formulario de solicitud
        document.getElementById('form-solicitar-chat')?.addEventListener('submit', enviarSolicitudChat);

        // Función para actualizar el badge de notificaciones
        async function actualizarBadgeChatPrivado() {
            const token = localStorage.getItem('authToken');
            if (!token || (!usuarioActual && !currentUser)) {
                return; // No hacer la petición si no hay token o usuario
            }

            try {
                const response = await fetch('/api/chat/solicitudes', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const solicitudes = await response.json();
                    const badge = document.getElementById('chat-privado-badge');

                    if (solicitudes.length > 0) {
                        badge.textContent = solicitudes.length;
                        badge.classList.remove('hidden');
                    } else {
                        badge.classList.add('hidden');
                    }
                }
            } catch (error) {
                console.error('Error al actualizar badge:', error);
            }
        }

        // Actualizar solicitudes cada 30 segundos
        setInterval(async () => {
            if (!document.getElementById('modal-chat-privado').classList.contains('hidden')) {
                await cargarSolicitudes();
            }
            // Siempre actualizar el badge si estamos en la sección de chat
            if (!document.getElementById('chat-section').classList.contains('hidden')) {
                await actualizarBadgeChatPrivado();
            }
        }, 30000);

        // ============= FUNCIONES NOTICIAS =============

        let noticias = [];
        let noticiasFiltradas = [];

        async function cargarNoticias() {
            try {
                const response = await fetch('/api/noticias');
                if (response.ok) {
                    noticias = await response.json();
                    noticiasFiltradas = [...noticias];
                    cargarNoticiasPreview();
                    if (!document.getElementById('modal-noticias').classList.contains('hidden')) {
                        mostrarNoticiasEnModal();
                    }
                }
            } catch (error) {
                console.error('Error al cargar noticias:', error);
            }
        }

        function cargarNoticiasPreview() {
            const container = document.getElementById('noticias-preview');
            if (!container) return;

            if (noticias.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-sm">No hay noticias disponibles</p>';
                return;
            }

            // Mostrar solo las 3 noticias más recientes
            const noticiasRecientes = noticias.slice(0, 3);
            let html = '';

            noticiasRecientes.forEach(noticia => {
                const fechaEvento = new Date(noticia.fechaEvento);
                const esProximo = fechaEvento > new Date();

                html += `
                    <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors cursor-pointer"
                         onclick="mostrarDetalleNoticia(${noticia.id})">
                        <div class="flex items-start justify-between mb-2">
                            <div class="flex items-center space-x-2">
                                <span class="px-2 py-1 text-xs font-medium rounded-full ${getCategoriaColor(noticia.categoria)}">
                                    ${noticia.categoria}
                                </span>
                                ${noticia.prioridad === 'alta' ? '<i class="fas fa-exclamation-circle text-red-500 text-sm"></i>' : ''}
                            </div>
                            <span class="text-xs text-gray-500">${formatearFecha(noticia.fecha)}</span>
                        </div>
                        <h4 class="font-semibold text-gray-800 text-sm mb-1">${noticia.titulo}</h4>
                        <p class="text-gray-600 text-xs">${noticia.contenido.substring(0, 80)}...</p>
                        ${esProximo && noticia.fechaEvento !== '2025-10-01' ? `
                            <div class="mt-2 text-xs text-blue-600 flex items-center space-x-1">
                                <i class="fas fa-calendar-alt"></i>
                                <span>${formatearFechaEvento(noticia.fechaEvento, noticia.horaEvento)}</span>
                            </div>
                        ` : ''}
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function getCategoriaColor(categoria) {
            const colores = {
                'Administrativo': 'bg-blue-100 text-blue-800',
                'Social': 'bg-purple-100 text-purple-800',
                'Mantenimiento': 'bg-orange-100 text-orange-800',
                'Seguridad': 'bg-red-100 text-red-800'
            };
            return colores[categoria] || 'bg-gray-100 text-gray-800';
        }

        function formatearFecha(fecha) {
            return new Date(fecha).toLocaleDateString('es-CO', {
                day: 'numeric',
                month: 'short'
            });
        }

        function formatearFechaEvento(fecha, hora) {
            const fechaObj = new Date(fecha);
            const fechaStr = fechaObj.toLocaleDateString('es-CO', {
                day: 'numeric',
                month: 'short',
                year: 'numeric'
            });

            if (hora && hora !== '00:00') {
                const horaStr = hora.substring(0, 5);
                return `${fechaStr} - ${horaStr}`;
            }
            return fechaStr;
        }

        async function abrirModalNoticias() {
            await cargarNoticias();
            document.getElementById('modal-noticias').classList.remove('hidden');
            mostrarNoticiasEnModal();
        }

        function cerrarModalNoticias() {
            document.getElementById('modal-noticias').classList.add('hidden');
        }

        function filtrarNoticias(categoria) {
            // Actualizar botones de filtro
            document.querySelectorAll('.filtro-noticia').forEach(btn => {
                btn.classList.remove('active', 'bg-green-100', 'text-green-800');
                btn.classList.add('bg-gray-100', 'text-gray-700');
            });

            event.target.classList.remove('bg-gray-100', 'text-gray-700');
            event.target.classList.add('active', 'bg-green-100', 'text-green-800');

            // Filtrar noticias
            if (categoria === 'todas') {
                noticiasFiltradas = [...noticias];
            } else {
                noticiasFiltradas = noticias.filter(noticia => noticia.categoria === categoria);
            }

            mostrarNoticiasEnModal();
        }

        function mostrarNoticiasEnModal() {
            const container = document.getElementById('lista-noticias');

            if (noticiasFiltradas.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">No hay noticias en esta categoría</p>';
                return;
            }

            let html = '';
            noticiasFiltradas.forEach(noticia => {
                const fechaEvento = new Date(noticia.fechaEvento);
                const esProximo = fechaEvento > new Date();

                html += `
                    <div class="bg-white border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow cursor-pointer"
                         onclick="mostrarDetalleNoticia(${noticia.id})">
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex items-center space-x-3">
                                <span class="px-3 py-1 text-sm font-medium rounded-full ${getCategoriaColor(noticia.categoria)}">
                                    ${noticia.categoria}
                                </span>
                                ${noticia.prioridad === 'alta' ? '<i class="fas fa-exclamation-circle text-red-500"></i>' : ''}
                            </div>
                            <span class="text-sm text-gray-500">${formatearFecha(noticia.fecha)}</span>
                        </div>

                        <h3 class="text-lg font-bold text-gray-800 mb-2">${noticia.titulo}</h3>
                        <p class="text-gray-600 mb-3">${noticia.contenido.substring(0, 150)}...</p>

                        ${esProximo && noticia.fechaEvento !== '2025-10-01' ? `
                            <div class="flex items-center space-x-4 text-sm text-blue-600 bg-blue-50 p-3 rounded-lg">
                                <div class="flex items-center space-x-1">
                                    <i class="fas fa-calendar-alt"></i>
                                    <span>${formatearFechaEvento(noticia.fechaEvento, noticia.horaEvento)}</span>
                                </div>
                                ${noticia.lugar ? `
                                    <div class="flex items-center space-x-1">
                                        <i class="fas fa-map-marker-alt"></i>
                                        <span>${noticia.lugar}</span>
                                    </div>
                                ` : ''}
                            </div>
                        ` : ''}

                        <div class="mt-3 pt-3 border-t border-gray-100 flex items-center justify-between">
                            <span class="text-xs text-gray-500">Click para ver detalles</span>
                            <i class="fas fa-arrow-right text-green-600"></i>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        async function mostrarDetalleNoticia(id) {
            try {
                const response = await fetch(`/api/noticias/${id}`);
                if (response.ok) {
                    const noticia = await response.json();
                    mostrarModalDetalle(noticia);
                } else {
                    mostrarNotificacion('Error al cargar la noticia', 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                mostrarNotificacion('Error de conexión', 'error');
            }
        }

        function mostrarModalDetalle(noticia) {
            const fechaEvento = new Date(noticia.fechaEvento);
            const esProximo = fechaEvento > new Date();

            const html = `
                <div class="p-6">
                    <div class="flex items-start justify-between mb-4">
                        <div class="flex items-center space-x-3">
                            <span class="px-3 py-1 text-sm font-medium rounded-full ${getCategoriaColor(noticia.categoria)}">
                                ${noticia.categoria}
                            </span>
                            ${noticia.prioridad === 'alta' ? '<i class="fas fa-exclamation-circle text-red-500"></i>' : ''}
                        </div>
                        <button onclick="cerrarModalDetalle()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>

                    <h2 class="text-2xl font-bold text-gray-800 mb-3">${noticia.titulo}</h2>

                    <div class="text-sm text-gray-500 mb-6">
                        Publicado el ${new Date(noticia.fecha).toLocaleDateString('es-CO', {
                            day: 'numeric',
                            month: 'long',
                            year: 'numeric'
                        })}
                    </div>

                    ${esProximo && noticia.fechaEvento !== '2025-10-01' ? `
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                            <h4 class="font-semibold text-blue-800 mb-2 flex items-center space-x-2">
                                <i class="fas fa-info-circle"></i>
                                <span>Información del Evento</span>
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm text-blue-700">
                                <div class="flex items-center space-x-2">
                                    <i class="fas fa-calendar-alt"></i>
                                    <span>${formatearFechaEvento(noticia.fechaEvento, noticia.horaEvento)}</span>
                                </div>
                                ${noticia.lugar ? `
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-map-marker-alt"></i>
                                        <span>${noticia.lugar}</span>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    ` : ''}

                    <div class="prose max-w-none text-gray-700">
                        ${noticia.contenido.split('\n').map(parrafo => `<p class="mb-4">${parrafo}</p>`).join('')}
                    </div>
                </div>
            `;

            document.getElementById('detalle-noticia-content').innerHTML = html;
            document.getElementById('modal-detalle-noticia').classList.remove('hidden');
        }

        function cerrarModalDetalle() {
            document.getElementById('modal-detalle-noticia').classList.add('hidden');
        }

        // Cargar noticias en el dashboard cuando el usuario esté autenticado
        function inicializarNoticias() {
            if (usuarioActual || currentUser) {
                cargarNoticias();
            }
        }

    </script>
    <!-- Floating Action Button -->
    <div class="fixed bottom-6 right-6 z-40">
        <button onclick="abrirModalReservas()" class="w-16 h-16 bg-blue-600 hover:bg-blue-700 text-white rounded-full shadow-xl transition-all duration-300 transform hover:scale-110 flex items-center justify-center">
            <i class="fas fa-plus text-xl"></i>
        </button>
    </div>

    </div> <!-- Cierre del main-app -->
</body>
</html>